<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„¸ê³„ê´€ ê·¸ë˜í”„ í¸ì§‘ê¸° with TTS</title>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: #f0f0f0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .left-panel {
      width: 25%;
      background: white;
      padding: 15px;
      overflow-y: auto;
      border-right: 2px solid #ddd;
    }

    .graph-area {
      width: 50%;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }

    .right-panel {
      width: 25%;
      background: white;
      padding: 15px;
      overflow-y: auto;
      border-left: 2px solid #ddd;
      display: flex;
      flex-direction: column;
    }

    #cy {
      flex: 1;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }

    .panel-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .panel-section h3 {
      font-size: 1em;
      margin-bottom: 10px;
      color: #667eea;
      border-bottom: 2px solid #667eea;
      padding-bottom: 5px;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9em;
    }

    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 4px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      color: white;
    }

    .btn-info {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }

    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: 'Malgun Gothic', monospace;
      font-size: 0.9em;
      resize: vertical;
      min-height: 150px;
    }

    .notes-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .notes-textarea {
      flex: 1;
      min-height: 200px;
      font-family: 'Malgun Gothic', sans-serif;
      line-height: 1.6;
    }

    .tts-controls {
      padding: 10px;
      background: #f0f7ff;
      border-radius: 6px;
      border: 1px solid #d0e7ff;
    }

    .tts-controls label {
      display: block;
      font-size: 0.85em;
      color: #555;
      margin: 8px 0 4px 0;
      font-weight: bold;
    }

    .speed-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .speed-control input[type="range"] {
      flex: 1;
    }

    .speed-value {
      min-width: 40px;
      text-align: center;
      font-weight: bold;
      color: #667eea;
    }

    .tts-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }

    .info-badge {
      display: inline-block;
      padding: 6px 12px;
      background: #667eea;
      color: white;
      border-radius: 4px;
      font-size: 0.85em;
      margin-bottom: 10px;
    }

    .help-text {
      font-size: 0.8em;
      color: #888;
      margin-top: 5px;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <header>
    <h1>ğŸŒ ì„¸ê³„ê´€ ê·¸ë˜í”„ í¸ì§‘ê¸° with TTS</h1>
    <p>ì›¹ì†Œì„¤ ì„¸ê³„ê´€ì„ ì‹œê°í™”í•˜ê³  ë©”ëª¨ë¥¼ ìŒì„±ìœ¼ë¡œ ë“¤ì–´ë³´ì„¸ìš”</p>
  </header>

  <div class="main-container">
    <div class="left-panel">
      <div class="panel-section">
        <h3>â• ë…¸ë“œ ì¶”ê°€</h3>
        <input type="text" id="newNode" placeholder="ë…¸ë“œ ì´ë¦„">
        <button class="btn-primary" onclick="addNode()">ë…¸ë“œ ì¶”ê°€</button>
        <div class="help-text">ğŸ’¡ ë¹ˆ ê³µê°„ì„ ë”ë¸”í´ë¦­í•´ë„ ë…¸ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
      </div>

      <div class="panel-section">
        <h3>ğŸ”— ê´€ê³„ ì—°ê²°</h3>
        <input type="text" id="edgeSrc" placeholder="ì¶œë°œ ë…¸ë“œ">
        <input type="text" id="edgeTgt" placeholder="ë„ì°© ë…¸ë“œ">
        <input type="text" id="edgeLbl" placeholder="ê´€ê³„ ë¼ë²¨">
        <button class="btn-primary" onclick="addEdge()">ì—°ê²° ì¶”ê°€</button>
        <div class="help-text">ğŸ’¡ Ctrl+ë“œë˜ê·¸ë¡œ ë…¸ë“œë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
      </div>

      <div class="panel-section">
        <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
        <button class="btn-success" onclick="saveToLocalStorage()">ğŸ’¾ ë¡œì»¬ ì €ì¥</button>
        <button class="btn-info" onclick="loadFromLocalStorage()">ğŸ“‚ ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn-primary" onclick="saveToURL()">ğŸ”— URLë¡œ ì €ì¥</button>
        <button class="btn-success" onclick="downloadJSON()">â¬‡ï¸ JSON ë‹¤ìš´ë¡œë“œ</button>
        <input type="file" id="fileInput" accept=".json" style="display:none" onchange="uploadJSON(event)">
        <button class="btn-info" onclick="document.getElementById('fileInput').click()">â¬†ï¸ JSON ì—…ë¡œë“œ</button>
        <div class="help-text">ğŸ’¡ URLë¡œ ì €ì¥í•˜ë©´ ì£¼ì†Œì°½ ë³µì‚¬ë¡œ ê³µìœ  ê°€ëŠ¥í•©ë‹ˆë‹¤</div>
      </div>

      <div class="panel-section">
        <h3>ğŸ“ ì„ íƒ í•­ëª©</h3>
        <div class="info-badge" id="selectionLabel">ì„ íƒ ì—†ìŒ</div>
        <textarea id="yamlEdit" placeholder="ë…¸ë“œ/ì—£ì§€ ì„ íƒ ì‹œ ë°ì´í„° í‘œì‹œ"></textarea>
        <button class="btn-success" onclick="saveSelected()">ì €ì¥</button>
        <button class="btn-danger" onclick="deleteSelected()">ì‚­ì œ</button>
      </div>
    </div>

    <div class="graph-area">
      <div id="cy"></div>
    </div>

    <div class="right-panel">
      <div class="panel-section notes-area">
        <h3>ğŸ“ ë©”ëª¨ì¥</h3>
        <div class="info-badge" id="notesInfo">ë…¸ë“œ/ì—£ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
        <textarea class="notes-textarea" id="notesTextarea" placeholder="ì—¬ê¸°ì— ë©”ëª¨ë¥¼ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
        <button class="btn-success" onclick="saveNotes()">ğŸ’¾ ë©”ëª¨ ì €ì¥</button>

        <div class="tts-controls">
          <h3 style="margin: 0 0 10px 0; font-size: 0.95em;">ğŸ”Š ì½ì–´ì£¼ê¸° (TTS)</h3>
          <label>ğŸ™ï¸ ìŒì„± ì„ íƒ</label>
          <select id="voiceSelect">
            <option value="ko-KR">í•œêµ­ì–´ (ê¸°ë³¸)</option>
          </select>
          <label>âš¡ ì†ë„</label>
          <div class="speed-control">
            <input type="range" id="speedControl" min="0.5" max="2.0" step="0.1" value="1.0"
              oninput="updateSpeedValue()">
            <span class="speed-value" id="speedValue">1.0x</span>
          </div>
          <div class="tts-buttons">
            <button class="btn-primary" onclick="readNotes()">ğŸ”Š ì½ê¸°</button>
            <button class="btn-danger" onclick="stopReading()">â¹ï¸ ì •ì§€</button>
          </div>
          <div class="help-text">ğŸ’¡ íŠ¹ìˆ˜ë¬¸ìëŠ” ìë™ìœ¼ë¡œ ì œê±°ë©ë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let initialData = [
      { data: { id: "ì£¼ì¸ê³µ", label: "ì£¼ì¸ê³µ", color: "#667eea", notes: "" } },
      { data: { id: "ì•„ë¦°", label: "ì•„ë¦°", color: "#f093fb", notes: "" } },
      { data: { id: "ev1", label: "ì‹œì‘ ì´ë²¤íŠ¸", color: "#4facfe", notes: "" } },
      { data: { id: "ì£¼ì¸ê³µ_ì•„ë¦°", source: "ì£¼ì¸ê³µ", target: "ì•„ë¦°", label: "ì¹œêµ¬", notes: "" } }
    ];

    let cy = cytoscape({
      container: document.getElementById('cy'),
      elements: JSON.parse(JSON.stringify(initialData)),
      style: [
        {
          selector: 'node', style: {
            'label': 'data(label)',
            'background-color': 'data(color)',
            'shape': 'round-rectangle',
            'width': 'label',
            'height': 30,
            'padding': '10px',
            'border-width': 2,
            'border-color': '#333',
            'border-style': 'solid',
            'text-valign': 'center',
            'text-halign': 'center',
            'color': '#fff',
            'font-weight': 'bold',
            'font-size': 14
          }
        },
        {
          selector: 'edge', style: {
            'label': 'data(label)',
            'curve-style': 'bezier',
            'line-color': '#999',
            'width': 1,
            'target-arrow-shape': 'triangle',
            'target-arrow-color': '#999',
            'font-size': 12
          }
        }
      ],
      layout: { name: 'cose', animate: true }
    });

    let selected = null, speechSynthesis = window.speechSynthesis, currentUtterance = null, edgeCreationMode = false, edgeSourceNode = null, nodeCounter = 1;

    window.addEventListener('load', function () {
      const hash = window.location.hash.substring(1);
      if (hash) {
        try {
          const decompressed = LZString.decompressFromEncodedURIComponent(hash);
          const data = JSON.parse(decompressed);
          cy.elements().remove();
          cy.add(data);
          cy.layout({ name: 'cose', animate: true }).run();
        } catch (e) { console.error('URL ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e); }
      }
    });

    cy.on('dbltap', function (evt) {
      if (evt.target === cy) {
        const pos = evt.position, nodeName = prompt("ìƒˆ ë…¸ë“œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "ë…¸ë“œ" + nodeCounter);
        if (nodeName && nodeName.trim()) {
          const id = nodeName.trim();
          if (cy.getElementById(id).length > 0) { alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë…¸ë“œ ì´ë¦„ì…ë‹ˆë‹¤!"); return; }
          const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
          cy.add({ data: { id: id, label: id, color: colors[Math.floor(Math.random() * colors.length)], notes: "" }, position: { x: pos.x, y: pos.y } });
          nodeCounter++;
        }
      }
    });

    cy.on('mousedown', 'node', function (evt) {
      if (evt.originalEvent.ctrlKey || evt.originalEvent.metaKey) {
        edgeCreationMode = true; edgeSourceNode = evt.target;
        evt.target.style({ 'border-width': '4px', 'border-color': '#43e97b', 'border-style': 'dashed' });
      }
    });
    cy.on('mouseover', 'node', function (evt) { if (edgeCreationMode && evt.target.id() !== edgeSourceNode.id()) evt.target.style({ 'border-width': '4px', 'border-color': '#4facfe' }); });
    cy.on('mouseout', 'node', function (evt) { if (edgeCreationMode && evt.target.id() !== edgeSourceNode.id()) evt.target.style('border-width', '2px'); });
    cy.on('mouseup', 'node', function (evt) {
      if (edgeCreationMode && evt.target.id() !== edgeSourceNode.id()) {
        const label = prompt("ê´€ê³„ ë¼ë²¨ì„ ì…ë ¥í•˜ì„¸ìš”:", "ê´€ê³„");
        if (label !== null) cy.add({ data: { id: edgeSourceNode.id() + "_" + evt.target.id() + "_" + Date.now(), source: edgeSourceNode.id(), target: evt.target.id(), label: label || "", notes: "" } });
        edgeSourceNode.style('border-width', '2px'); edgeCreationMode = false; edgeSourceNode = null;
      }
    });
    cy.on('mouseup', function (evt) { if (edgeCreationMode && evt.target === cy) { if (edgeSourceNode) edgeSourceNode.style('border-width', '2px'); edgeCreationMode = false; edgeSourceNode = null; } });

    // ------------------- â–¼ TTS í•¨ìˆ˜ ìˆ˜ì • ì‹œì‘ â–¼ -------------------
    
    function loadVoices() {
      const voices = speechSynthesis.getVoices();
      const voiceSelect = document.getElementById('voiceSelect');
      
      // ê¸°ì¡´ ì˜µì…˜ ì œê±°
      voiceSelect.innerHTML = '';
      
      // í•œêµ­ì–´ ìŒì„±ë§Œ í•„í„°ë§ (langì´ 'ko'ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìŒì„±)
      const koVoices = voices.filter(v => v.lang.startsWith('ko'));
      
      if (koVoices.length > 0) {
        koVoices.forEach((voice) => {
          const option = document.createElement('option');
          // option.valueì— voice.nameì„ ì €ì¥í•˜ì—¬ ê³ ìœ í•˜ê²Œ êµ¬ë¶„
          option.value = voice.name; 
          option.textContent = `${voice.name} (${voice.lang})${voice.default ? ' (ê¸°ë³¸)' : ''}`;
          voiceSelect.appendChild(option);
        });
      } else {
        // í•œêµ­ì–´ ìŒì„±ì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
        const option = document.createElement('option');
        option.value = "default";
        option.textContent = "í•œêµ­ì–´ ìŒì„± ì—†ìŒ (ì‹œìŠ¤í…œ ê¸°ë³¸)";
        voiceSelect.appendChild(option);
      }
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ í˜¸ì¶œí•˜ì—¬ ëª©ë¡ ì±„ìš°ê¸°
    loadVoices();
    
    function updateSpeedValue() { document.getElementById('speedValue').textContent = document.getElementById('speedControl').value + 'x'; }

    function cleanTextForTTS(text) {
      return text
        .replace(/[#*_~`\[\]{}()\-+=|\\<>]/g, ' ')
        .replace(/[!@$%^&]/g, ' ')
        .replace(/[:;]/g, ',')
        .replace(/[.]{2,}/g, '.')
        .replace(/\s+/g, ' ')
        .trim();
    }

    function readNotes() {
      const text = document.getElementById('notesTextarea').value.trim();
      if (!text) { alert('ì½ì„ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤!'); return; }
      stopReading();
      
      const cleanedText = cleanTextForTTS(text);
      currentUtterance = new SpeechSynthesisUtterance(cleanedText);
      
      const voices = speechSynthesis.getVoices();
      const selectedVoiceName = document.getElementById('voiceSelect').value;
      
      // ì„ íƒëœ ìŒì„± ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” Voice ê°ì²´ë¥¼ ì°¾ì•„ ì ìš©
      const selectedVoice = voices.find(v => v.name === selectedVoiceName);

      if (selectedVoice) {
        currentUtterance.voice = selectedVoice;
        currentUtterance.lang = selectedVoice.lang; // ì„ íƒëœ ìŒì„±ì˜ ì–¸ì–´ ì„¤ì •
      } else {
        // ì„ íƒëœ ìŒì„±ì„ ì°¾ì§€ ëª»í•˜ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
        currentUtterance.lang = 'ko-KR'; 
      }
      
      currentUtterance.rate = parseFloat(document.getElementById('speedControl').value); 
      currentUtterance.pitch = 1.0; 
      currentUtterance.volume = 1.0;
      
      speechSynthesis.speak(currentUtterance);
    }
    
    function stopReading() { if (speechSynthesis.speaking) speechSynthesis.cancel(); currentUtterance = null; }
    
    // ------------------- â–² TTS í•¨ìˆ˜ ìˆ˜ì • ë â–² -------------------

    function addNode() {
      const id = document.getElementById('newNode').value.trim();
      if (!id) { alert('ë…¸ë“œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!'); return; }
      if (cy.getElementById(id).length > 0) { alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë…¸ë“œì…ë‹ˆë‹¤!'); return; }
      const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
      cy.add({ data: { id: id, label: id, color: colors[Math.floor(Math.random() * colors.length)], notes: "" } });
      cy.layout({ name: 'cose', animate: true }).run();
      document.getElementById('newNode').value = '';
    }

    function addEdge() {
      const src = document.getElementById('edgeSrc').value.trim(), tgt = document.getElementById('edgeTgt').value.trim(), lbl = document.getElementById('edgeLbl').value.trim();
      if (!src || !tgt) { alert('ì¶œë°œ ë…¸ë“œì™€ ë„ì°© ë…¸ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!'); return; }
      if (cy.getElementById(src).length === 0 || cy.getElementById(tgt).length === 0) { alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¸ë“œì…ë‹ˆë‹¤!'); return; }
      cy.add({ data: { id: src + "_" + tgt + "_" + Date.now(), source: src, target: tgt, label: lbl || "", notes: "" } });
      document.getElementById('edgeSrc').value = ''; document.getElementById('edgeTgt').value = ''; document.getElementById('edgeLbl').value = '';
    }

    function saveToLocalStorage() { localStorage.setItem("graphData", JSON.stringify(cy.json().elements)); alert('ë¡œì»¬ ì €ì¥ ì™„ë£Œ!'); }
    function loadFromLocalStorage() {
      const data = localStorage.getItem("graphData");
      if (data) { cy.elements().remove(); cy.add(JSON.parse(data)); cy.layout({ name: 'cose', animate: true }).run(); alert('ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!'); }
      else alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
    }

    function saveToURL() {
      const json = cy.json().elements;
      const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(json));
      window.location.hash = compressed;
      alert('URLì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì£¼ì†Œì°½ì˜ URLì„ ë³µì‚¬í•˜ì—¬ ê³µìœ í•˜ì„¸ìš”.');
    }

    function downloadJSON() {
      const json = cy.json().elements;
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(json, null, 2));
      const downloadAnchorNode = document.createElement('a');
      downloadAnchorNode.setAttribute("href", dataStr);
      downloadAnchorNode.setAttribute("download", "graph_" + new Date().toISOString().slice(0, 10) + ".json");
      document.body.appendChild(downloadAnchorNode);
      downloadAnchorNode.click();
      downloadAnchorNode.remove();
      alert('JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
    }

    function uploadJSON(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const data = JSON.parse(e.target.result);
            cy.elements().remove();
            cy.add(data);
            cy.layout({ name: 'cose', animate: true }).run();
            alert('JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
          } catch (err) { alert('JSON íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜: ' + err.message); }
        };
        reader.readAsText(file);
      }
    }

    cy.on('tap', 'node', function (evt) {
      const node = evt.target;
      selected = { type: 'node', id: node.id() };
      document.getElementById('selectionLabel').innerText = "ë…¸ë“œ: " + node.id();
      document.getElementById('yamlEdit').value = JSON.stringify(node.data(), null, 2);
      document.getElementById('notesInfo').innerText = "ë…¸ë“œ: " + node.id();
      document.getElementById('notesTextarea').value = node.data('notes') || '';
    });

    cy.on('tap', 'edge', function (evt) {
      const edge = evt.target;
      selected = { type: 'edge', id: edge.id() };
      document.getElementById('selectionLabel').innerText = "ì—£ì§€: " + edge.data('source') + " â†’ " + edge.data('target');
      document.getElementById('yamlEdit').value = JSON.stringify(edge.data(), null, 2);
      document.getElementById('notesInfo').innerText = "ì—£ì§€: " + edge.data('source') + " â†’ " + edge.data('target');
      document.getElementById('notesTextarea').value = edge.data('notes') || '';
    });

    function saveSelected() {
      if (!selected) { alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤!'); return; }
      try {
        const obj = JSON.parse(document.getElementById('yamlEdit').value);
        cy.getElementById(selected.id).data(obj);
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (e) { alert('JSON í˜•ì‹ ì˜¤ë¥˜: ' + e.message); }
    }

    function deleteSelected() {
      if (!selected) { alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤!'); return; }
      if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        cy.getElementById(selected.id).remove();
        selected = null;
        document.getElementById('selectionLabel').innerText = 'ì„ íƒ ì—†ìŒ';
        document.getElementById('yamlEdit').value = '';
        document.getElementById('notesInfo').innerText = 'ë…¸ë“œ/ì—£ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”';
        document.getElementById('notesTextarea').value = '';
      }
    }

    function saveNotes() {
      if (!selected) { alert('ë…¸ë“œ ë˜ëŠ” ì—£ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”!'); return; }
      const notesText = document.getElementById('notesTextarea').value;
      cy.getElementById(selected.id).data('notes', notesText);
      document.getElementById('yamlEdit').value = JSON.stringify(cy.getElementById(selected.id).data(), null, 2);
      alert('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  </script>
</body>

</html>