<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„¸ê³„ê´€ ê·¸ë˜í”„ í¸ì§‘ê¸° (Complete Ver)</title>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
  <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Malgun Gothic', sans-serif; background: #f0f0f0; height: 100vh; display: flex; flex-direction: column; }
    
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 15px 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    header h1 { font-size: 1.5em; margin-bottom: 5px; text-shadow: 1px 1px 0 #000; }

    .main-container { display: flex; flex: 1; overflow: hidden; }
    .left-panel { width: 25%; background: white; padding: 15px; overflow-y: auto; border-right: 2px solid #ddd; }
    .graph-area { width: 50%; padding: 15px; display: flex; flex-direction: column; }
    .right-panel { width: 25%; background: white; padding: 15px; overflow-y: auto; border-left: 2px solid #ddd; display: flex; flex-direction: column; }

    #cy { flex: 1; border: 2px solid #ddd; border-radius: 8px; background: #fafafa; }

    .panel-section { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; border: 1px solid #e0e0e0; }
    .panel-section h3 { font-size: 1em; margin-bottom: 10px; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 5px; }

    input[type="text"], input[type="number"], select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9em; }
    input[readonly] { background-color: #e9ecef; color: #495057; cursor: not-allowed; }

    button {
      width: 100%; padding: 10px; margin: 5px 0; border: none; border-radius: 4px; font-size: 0.9em;
      cursor: pointer; transition: all 0.1s; font-weight: bold; color: white; text-shadow: 1px 1px 0 #000;
    }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
    .btn-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .btn-danger { background: linear-gradient(135deg, #ff5f6d 0%, #ffc371 100%); }
    .btn-warning { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: white; }
    button:active { transform: scale(0.98); }

    textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Malgun Gothic', monospace; font-size: 0.9em; resize: vertical; min-height: 150px; }
    .notes-area { flex: 1; display: flex; flex-direction: column; gap: 10px; }
    .notes-textarea { flex: 1; min-height: 200px; line-height: 1.6; }

    .tts-controls { padding: 10px; background: #f0f7ff; border-radius: 6px; border: 1px solid #d0e7ff; }
    .speed-control { display: flex; align-items: center; gap: 10px; }
    .speed-control input[type="range"] { flex: 1; }
    .tts-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }

    .info-badge { display: inline-block; padding: 6px 12px; background: #667eea; color: white; border-radius: 4px; font-size: 0.85em; margin-bottom: 10px; text-shadow: 1px 1px 0 #000; }
    .help-text { font-size: 0.8em; color: #888; margin-top: 5px; padding: 8px; background: #f9f9f9; border-radius: 4px; }
    
    .connection-tools { display: flex; gap: 5px; margin-bottom: 5px; }
    .connection-tools button { padding: 5px; font-size: 0.8em; margin: 0; }
    
    .drag-mode-active { background: #ff0055 !important; animation: pulse 2s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 0, 85, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0); } }

    /* === NEW STYLES for Gemini Shortcut and Help Text === */
    .btn-gemini {
        background-color: #5555ff; /* Geminië¥¼ ìƒì§•í•˜ëŠ” íŒŒë€ìƒ‰ ê³„ì—´ */
        color: white; 
        padding: 10px; 
        border: none; 
        border-radius: 4px; 
        cursor: pointer; 
        width: 100%; 
        margin-top: 10px;
        font-weight: bold;
        transition: background-color 0.2s;
        text-shadow: 1px 1px 0 #000; /* ê¸°ì¡´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ê³¼ í†µì¼ */
    }

    .btn-gemini:hover {
        background-color: #4444cc;
    }

    .help-text-api {
        font-size: 0.85em; 
        color: #333; 
        margin-top: 8px;
        padding: 8px;
        border: 1px dashed #5555ff; /* Gemini ìƒ‰ìƒì— ë§ì¶˜ ì ì„  í…Œë‘ë¦¬ */
        border-radius: 4px;
        background: #e6e6ff; /* ì—°í•œ ë°°ê²½ìƒ‰ */
        margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ ì„¸ê³„ê´€ ê·¸ë˜í”„ í¸ì§‘ê¸° (ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)</h1>
    <p>í´ë¦­ ì—°ê²° + ë“œë˜ê·¸ ì—°ê²° + ì„ íƒ ì‚­ì œ ê¸°ëŠ¥ í†µí•© ë²„ì „</p>
  </header>

  <div class="main-container">
    <div class="left-panel">
      <div class="panel-section">
        <h3>â• ë…¸ë“œ ì¶”ê°€</h3>
        <input type="text" id="newNode" placeholder="ë…¸ë“œ ì´ë¦„ (ì˜ˆ: ì² ìˆ˜)">
        <button class="btn-primary" onclick="addNode()">ë…¸ë“œ ì¶”ê°€</button>
        <div class="help-text">ğŸ’¡ ë¹ˆ ê³µê°„ ë”ë¸”í´ë¦­ìœ¼ë¡œë„ ì¶”ê°€ ê°€ëŠ¥</div>
      </div>

      <div class="panel-section">
        <h3>ğŸ”— ì‰¬ìš´ ê´€ê³„ ì—°ê²°</h3>
        <button id="btnDragMode" class="btn-warning" onclick="toggleDragMode()">ğŸ–±ï¸ ë“œë˜ê·¸ ì—°ê²° ëª¨ë“œ (ì¼œê¸°/ë„ê¸°)</button>
        <div class="help-text" style="margin-bottom:10px;">ğŸ‘† ì¼œë©´ ë…¸ë“œë¥¼ ë“œë˜ê·¸í•´ì„œ ë°”ë¡œ ì—°ê²°ë©ë‹ˆë‹¤!</div>
        <div style="border-top: 1px dashed #ccc; margin: 10px 0;"></div>
        
        <div class="connection-tools">
            <button class="btn-info" onclick="clearEdgeInputs()" title="ì…ë ¥ ì´ˆê¸°í™”">ğŸ”„ ì´ˆê¸°í™”</button>
            <button class="btn-info" onclick="swapEdgeInputs()" title="ì¶œë°œ/ë„ì°© ë°”ê¾¸ê¸°">â†”ï¸ êµì²´</button>
        </div>
        <input type="text" id="edgeSrc" placeholder="1. ì¶œë°œ ë…¸ë“œ í´ë¦­" readonly style="background-color: #e3f2fd; cursor: pointer;">
        <input type="text" id="edgeTgt" placeholder="2. ë„ì°© ë…¸ë“œ í´ë¦­" readonly style="background-color: #ffebee; cursor: pointer;">
        <input type="text" id="edgeLbl" placeholder="ê´€ê³„ ë¼ë²¨ (ì˜ˆ: ì¹œêµ¬, ì )">
        <button class="btn-primary" onclick="addEdge()">ì—°ê²° ì¶”ê°€</button>
        <div class="help-text">ğŸ’¡ ê·¸ë˜í”„ì—ì„œ ë…¸ë“œë¥¼ <b>í´ë¦­</b>í•˜ë©´ ìœ„ ì¹¸ì— ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.</div>
      </div>

      <div class="panel-section">
        <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
        <button class="btn-success" onclick="saveToLocalStorage()">ğŸ’¾ ë¡œì»¬ ì €ì¥</button>
        <button class="btn-info" onclick="loadFromLocalStorage()">ğŸ“‚ ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn-primary" onclick="saveToURL()">ğŸ”— URLë¡œ ì €ì¥</button>
        <button class="btn-success" onclick="downloadJSON()">â¬‡ï¸ JSON ë‹¤ìš´ë¡œë“œ</button>
        <input type="file" id="fileInput" accept=".json" style="display:none" onchange="uploadJSON(event)">
        <button class="btn-info" onclick="document.getElementById('fileInput').click()">â¬†ï¸ JSON ì—…ë¡œë“œ</button>
        <input type="file" id="appendFileInput" accept=".json" style="display:none" onchange="appendJSON(event)">
        <button class="btn-primary" onclick="document.getElementById('appendFileInput').click()">â• JSON ì¶”ê°€ ì—…ë¡œë“œ</button>
        
        <textarea id="geminiPromptTemplate" style="height:1px; opacity:0; resize:none; position:absolute; left:-9999px;">
		**ì£¼ì˜: ì´ ìš”ì²­ì— ëŒ€í•´ JSON ì½”ë“œ ë¸”ë¡ ì™¸ì˜ ì–´ë– í•œ ì„¤ëª…, ì¸ì‚¬ë§, ì¶”ê°€ í…ìŠ¤íŠ¸ë„ ì ˆëŒ€ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”. ì˜¤ì§ JSON ì½”ë“œ ë¸”ë¡ë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.**

			ë‹¹ì‹ ì€ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ê´€ê³„í˜• ë°ì´í„°(ë…¸ë“œì™€ ì—£ì§€)ë¥¼ Cytoscape.js ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì í•©í•œ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì „ë¬¸ ë¶„ì„ê°€ì…ë‹ˆë‹¤.

			ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ë“±ì¥ì¸ë¬¼(ë…¸ë“œ)ê³¼ ê´€ê³„(ì—£ì§€)ë¥¼ ì¶”ì¶œí•˜ê³ , ìš”ì²­ëœ í˜•ì‹ì— ë§ì¶° **JSON ì½”ë“œ ë¸”ë¡**ìœ¼ë¡œ ì‘ë‹µí•´ ì£¼ì„¸ìš”.

		### ë¶„ì„í•  í…ìŠ¤íŠ¸ (ì—¬ê¸°ì— ì‚¬ìš©ìê°€ ë¶„ì„í•  ìŠ¤í† ë¦¬ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.) ###
		ì˜ˆì‹œ: 'ì² ìˆ˜ëŠ” ì˜í¬ì˜ ì¹œêµ¬ì´ë©°, ë¯¼ìˆ˜ëŠ” ì² ìˆ˜ì˜ ë™ë£Œì´ë‹¤. í˜œêµëŠ” ì•„ë¦°ì˜ ìŠ¤ìŠ¹ì´ë‹¤.'

		### ì¶œë ¥ í˜•ì‹ (JSON Only) ###
		```json
		{
	"elements": [
    {"data": {"id": "ì² ìˆ˜", "label": "ì² ìˆ˜", "color": "#667eea"}},
    {"data": {"id": "ì˜í¬", "label": "ì˜í¬", "color": "#f093fb"}},
    {"data": {"id": "ë¯¼ìˆ˜", "label": "ë¯¼ìˆ˜", "color": "#4facfe"}},
    {"data": {"source": "ì² ìˆ˜", "target": "ì˜í¬", "label": "ì¹œêµ¬"}},
    {"data": {"source": "ë¯¼ìˆ˜", "target": "ì² ìˆ˜", "label": "ë™ë£Œ"}}
  ]
}
</textarea>
        <button class="btn-gemini" onclick="copyPromptAndOpenGemini()">âœ¨ Gemini í”„ë¡¬í”„íŠ¸ ë³µì‚¬ ë° ì±„íŒ… ì—´ê¸°</button>
        <div class="help-text-api">
            1. ìœ„ ë²„íŠ¼ í´ë¦­: **JSON í˜•ì‹ ìš”ì²­ ëª…ë ¹ì–´ ë³µì‚¬** ë° Gemini ì±„íŒ… ì°½ ì—´ë¦¼.<br>
            2. Geminiì— ë¶™ì—¬ë„£ê¸° í›„ **(ì—¬ê¸°ì—...ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.)** ë¶€ë¶„ì— ë¶„ì„í•  í…ìŠ¤íŠ¸ ì¶”ê°€.<br>
            3. Gemini ì‘ë‹µ JSONì„ ë³µì‚¬í•˜ì—¬ ì•„ë˜ **'JSON í…ìŠ¤íŠ¸ ë³€í™˜ (ìˆ˜ë™)'** ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê¸°.
        </div>
      </div>
      
      <div class="panel-section">
        <h3>ğŸ¤– JSON í…ìŠ¤íŠ¸ ë³€í™˜ (ìˆ˜ë™)</h3>
        <textarea id="jsonInputTextarea" placeholder="ì—¬ê¸°ì— JSON í˜•ì‹ì˜ ë…¸ë“œ/ì—£ì§€ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (ìì—°ì–´ ì²˜ë¦¬ ì•„ë‹˜)" rows="8"></textarea>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px;">
            <button class="btn-primary" onclick="loadJSONFromTextarea(false)">âœ”ï¸ JSONìœ¼ë¡œ ë®ì–´ì“°ê¸°</button>
            <button class="btn-success" onclick="loadJSONFromTextarea(true)">â• JSON ì¶”ê°€í•˜ê¸°</button>
        </div>
        <div class="help-text">âš ï¸ **ì£¼ì˜:** ì´ ê¸°ëŠ¥ì€ ìì—°ì–´ ì²˜ë¦¬ê°€ ì•„ë‹Œ, **ìœ íš¨í•œ JSON í…ìŠ¤íŠ¸**ë¥¼ ì½ì–´ ê·¸ë˜í”„ì— ë°˜ì˜í•©ë‹ˆë‹¤.</div>
      </div>

      <div class="panel-section">
        <h3>âœ¨ ë ˆì´ì•„ì›ƒ</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
          <button class="btn-info" onclick="runLayout('cose')">ğŸ’« ê¸°ë³¸</button>
          <button class="btn-info" onclick="runLayout('dagre')">ğŸŒ² íŠ¸ë¦¬í˜•</button>
        </div>
      </div>
    </div>

    <div class="graph-area">
      <div id="cy"></div>
    </div>
    
    <div class="right-panel">
      <div class="panel-section notes-area">
        <h3>âœï¸ ì†ì„± í¸ì§‘ / ì‚­ì œ</h3>
        <div class="info-badge" id="notesInfo">ë…¸ë“œ/ì—£ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
        
        <label style="font-weight: bold; color: #333;">ì´ë¦„/ë¼ë²¨</label>
        <input type="text" id="labelInput" placeholder="ì„ íƒí•œ ìš”ì†Œì˜ ì´ë¦„" disabled>
        
        <div id="colorControl" style="display:none;">
            <label style="font-weight: bold; color: #333; margin-top: 10px;">ë…¸ë“œ ìƒ‰ìƒ</label>
            <input type="color" id="colorInput" value="#667eea" style="height: 40px; padding: 0;">
        </div>
        <label style="font-weight: bold; color: #333; margin-top: 10px;">ğŸ“ ë©”ëª¨</label>
        <textarea class="notes-textarea" id="notesTextarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button class="btn-success" onclick="saveNotes()">ğŸ’¾ ì €ì¥</button>
            <button class="btn-danger" onclick="deleteSelected()">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
        <div class="help-text">ğŸ’¡ ì„ íƒ í›„ Delete í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì‚­ì œë©ë‹ˆë‹¤.</div>

        <div class="tts-controls">
          <h3>ğŸ”Š ì½ì–´ì£¼ê¸° (TTS)</h3>
          <select id="voiceSelect"><option value="ko-KR">í•œêµ­ì–´</option></select>
          <div class="speed-control">
            <input type="range" id="speedControl" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateSpeedValue()">
            <span class="speed-value" id="speedValue">1.0x</span>
          </div>
          <div class="tts-buttons">
            <button class="btn-primary" onclick="readNotes()">ğŸ”Š ì½ê¸°</button>
            <button class="btn-danger" onclick="stopReading()">â¹ï¸ ì •ì§€</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let initialData = [
  { "data": { "id": "STC_01", "label": "STC 01 ì˜¤í”„ë‹ ì´ë¯¸ì§€", "color": "#ffaa00", "notes": "ë¯¸ìˆ  êµì‚¬ ì•ˆìœ¤ìˆ˜ì˜ ë¬´ì±„ìƒ‰ ì¼ìƒ. ì •ì§€ëœ í™”ë©´ ì†ì—ì„œ ì•„ë¬´ê²ƒë„ ê·¸ë¦¬ì§€ ëª»í•˜ëŠ” ìº”ë²„ìŠ¤ëŠ” TRB_02(ê³¼ê±°ì˜ ì¹¨ë¬µ)ì— ì§“ëˆŒë¦° ê·¸ë…€ì˜ í˜„ì¬ë¥¼ ì‹œê°ì  ì€ìœ ë¡œ ë³´ì—¬ì¤Œ." }, "position": { "x": 168.84393517707008, "y": -19.425202675389627 }, "group": "nodes" },
  { "data": { "id": "TRB_02", "label": "TRB 02 ìœ ë ¹ê³¼ ì„¸ê³„", "color": "#4facfe", "notes": "ê³¼ê±° ìì‹ ì˜ ì˜ëª»ì´ ì•„ë‹˜ì—ë„ íƒ€ì¸ì˜ ì•ˆìœ„ë¥¼ ìœ„í•´ ì¹¨ë¬µí•´ì•¼ í–ˆë˜ íŠ¸ë¼ìš°ë§ˆ. ì§„ì‹¤ë³´ë‹¤ ì§‘ë‹¨ì˜ í‰íŒê³¼ ì•ˆì •ì„ ìš°ì„ ì‹œí•˜ëŠ” ìœ„ì„ ì ì¸ êµìœ¡ê³„ì™€ ë²•ì¡°ê³„ì˜ ë°°ê²½." }, "position": { "x": -18.732381091892634, "y": 96.96598307075942 }, "group": "nodes" },
  { "data": { "id": "STC_02", "label": "STC 02 í…Œë§ˆ ì œì‹œ", "color": "#ffaa00", "notes": "ìœ¤ìˆ˜ì˜ ë™ë£Œ í˜¹ì€ ë‚¯ì„  ëª¨ì€ì´ ë˜ì§€ëŠ” ì§ˆë¬¸. 'ì§„ì‹¤ì„ ìë°±í•˜ëŠ” ë° ë”°ë¥´ëŠ” ëŒ€ê°€ë¥¼ ê°ë‹¹í•  ìˆ˜ ìˆê² ì–´?' ì´ëŠ” TRB_03(ì•½ì )ì¸ ê·¸ë…€ì˜ ë„ë•ì  ê²°ë²½ì¦ê³¼ ìˆ˜ë™ì„±ì„ ìê·¹í•¨." }, "position": { "x": 315.04222689673963, "y": 80.5865490935858 }, "group": "nodes" },
  { "data": { "id": "TRB_03", "label": "TRB 03 ì•½ì ê³¼ í•„ìš”", "color": "#4facfe", "notes": "ì•½ì : ê°ˆë“±ì„ íšŒí”¼í•˜ê³  ìˆœì‘í•˜ëŠ” íƒœë„. í•„ìš”: íƒ€ì¸ì˜ ì‹œì„ ì—ì„œ ë²—ì–´ë‚˜ ìì‹ ì˜ ì§„ì‹¤ì„ ìŠ¤ìŠ¤ë¡œ ì„ í¬í•˜ëŠ” ì£¼ì²´ì  ëª©ì†Œë¦¬ì˜ íšŒë³µ." }, "position": { "x": 64.03373498399164, "y": 244.07221488737838 }, "group": "nodes" },
  { "data": { "id": "STC_03", "label": "STC 03 ì„¸íŠ¸ì—…", "color": "#ffaa00", "notes": "ìœ¤ìˆ˜ì˜ í‰ë²”í•œ ì‚¶ê³¼ ê·¸ë…€ì˜ ì£¼ë³€ì„ ë§´ë„ëŠ” ì •ì²´ë¶ˆëª…ì˜ ì—¬ì ëª¨ì€. PRP_01(ë³´í˜¸ìì˜ ë¶€ì¬) ìƒí™©ì—ì„œ ìœ¤ìˆ˜ì˜ ì•ˆì „ë§ì´ ì–¼ë§ˆë‚˜ ì·¨ì•½í•œì§€ ë³´ì—¬ì¤Œ." }, "position": { "x": 417.1133509751031, "y": 158.48821607427357 }, "group": "nodes" },
  { "data": { "id": "PRP_01", "label": "PRP 01 ë¶€ì¬", "color": "#667eea", "notes": "ìœ¤ìˆ˜ê°€ ìœ„ê¸°ì— ì²˜í–ˆì„ ë•Œ ê·¸ë…€ë¥¼ ë³€í˜¸í•´ ì¤„ ê°€ì¡±ì´ë‚˜ ì •ì˜ë¡œìš´ ê³µê¶Œë ¥ì˜ ì™„ì „í•œ ê²°ì—¬. ì‚¬íšŒì  ê³ ë¦½ ìƒíƒœì˜ ì‹œë°œì ." }, "position": { "x": 268.5237454657867, "y": 351.5987780888795 }, "group": "nodes" },
  { "data": { "id": "STC_04", "label": "STC 04 ì´‰ë§¤ ì‚¬ê±´", "color": "#ffaa00", "notes": "ì˜ë¬¸ì˜ ì‚´ì¸ ì‚¬ê±´ ë°œìƒ. ìœ¤ìˆ˜ëŠ” ê°€ì¥ ìœ ë ¥í•œ ìš©ì˜ìë¡œ ì§€ëª©ë¨. ì´ëŠ” PRP_08(ì•…í–‰)ì— ì˜í•´ ì„¤ê³„ëœ ë«ì´ë©° ìœ¤ìˆ˜ì˜ í‰ì˜¨í•œ ì„¸ê³„ë¥¼ ì™„ì „íˆ íŒŒê´´í•¨." }, "position": { "x": 514.1440302932926, "y": 303.7857977974989 }, "group": "nodes" },
  { "data": { "id": "PRP_08", "label": "PRP 08 ì•…í–‰/ê²°í•", "color": "#667eea", "notes": "ë°°í›„ì˜ ì•…ë‹¹ì´ ì‚¬ê±´ì„ ì¡°ì‘í•˜ì—¬ ìœ¤ìˆ˜ì—ê²Œ ëˆ„ëª…ì„ ì”Œì›€. ìœ¤ìˆ˜ëŠ” 'ììœ 'ì™€ 'ëª…ì˜ˆ'ë¼ëŠ” ê·¼ì›ì  ê°€ì¹˜ë¥¼ ë°•íƒˆë‹¹í•˜ëŠ” ê·¹ì‹¬í•œ ê²°í• ìƒíƒœì— ì§ë©´." }, "position": { "x": 382.92714472576296, "y": 392.3062354829383 }, "group": "nodes" },
  { "data": { "id": "STC_05", "label": "STC 05 ê³ ë¯¼/ì €í•­", "color": "#ffaa00", "notes": "ëª¨ì€ì´ ê±´ë„¤ëŠ” ì†ê¸¸(PRP_09)ì— ëŒ€í•œ ê±°ë¶€ê°. ë²•ì  ì‹œìŠ¤í…œ ì•ˆì—ì„œ í•´ê²°í•˜ë ¤ëŠ” ê´€ì„±ê³¼ ë²•ë§ ë°–ì˜ ëª¨ì€ì„ ë¯¿ì–´ì•¼ í•˜ëŠ” ë„ë°• ì‚¬ì´ì˜ ì²˜ì ˆí•œ ë‚´ì  ê°ˆë“±." }, "position": { "x": 597.8127937871561, "y": 437.00908355078764 }, "group": "nodes" },
  { "data": { "id": "PRP_09", "label": "PRP 09 ë§¤ê°œ", "color": "#667eea", "notes": "ëª¨ì€ì´ ìœ¤ìˆ˜ì—ê²Œ ì‚¬ê±´ì˜ ì§„ì‹¤ì„ íŒŒí—¤ì¹  'ì—´ì‡ ' í˜¹ì€ 'ìœ„í—˜í•œ ì œì•ˆ'ì„ ê±´ë„´. ì´ëŠ” ì£¼ì¸ê³µì´ ëª¨í—˜ì˜ ì„¸ê³„ë¡œ ì§„ì…í•˜ê²Œ í•˜ëŠ” ê²°ì •ì  ë§¤ê°œ ì¥ì¹˜." }, "position": { "x": 215.16758614952508, "y": 500.3224998715594 }, "group": "nodes" },
  { "data": { "id": "STC_06", "label": "STC 06 2ë§‰ ì§„ì…", "color": "#ffaa00", "notes": "ìœ¤ìˆ˜ê°€ ë²•ì  í…Œë‘ë¦¬ë¥¼ ë²—ì–´ë‚˜ ëª¨ì€ê³¼ ì†ì„ ì¡ê¸°ë¡œ ê²°ì‹¬í•¨. TRB_05(ìš•ë§ êµ¬ì²´í™”)ê°€ ì¼ì–´ë‚˜ë©° ìˆ˜ë™ì  í”¼í•´ìì—ì„œ ëŠ¥ë™ì  ì¶”ê²©ìë¡œ ë³€ëª¨." }, "position": { "x": 595.2478812365936, "y": 533.4381924765761 }, "group": "nodes" },
  { "data": { "id": "TRB_05", "label": "TRB 05 ìš•ë§ êµ¬ì²´í™”", "color": "#4facfe", "notes": "ë‹¨ìˆœí•œ ë¬´ì£„ ì…ì¦ì´ ëª©í‘œê°€ ì•„ë‹˜. ìì‹ ì„ íŒŒê´´í•˜ë ¤ í•œ ì‹œìŠ¤í…œì˜ ì‹¬ì¥ë¶€ë¥¼ ì°¾ì•„ë‚´ì–´ ê·¸ ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê²Œ í•˜ê² ë‹¤ëŠ” êµ¬ì²´ì  ë³µìˆ˜ì‹¬ê³¼ ì •ì˜ê°ì˜ ê²°í•©." }, "position": { "x": 455.19409650615574, "y": 659.1434128146807 }, "group": "nodes" },
  { "data": { "id": "STC_07", "label": "STC 07 BìŠ¤í† ë¦¬", "color": "#ffaa00", "notes": "ìœ¤ìˆ˜ì™€ ëª¨ì€ì˜ ê¸°ë¬˜í•œ ë™í–‰. TRB_06(ì¡°ë ¥ì) ëª¨ì€ì˜ íŒŒê´´ì ì¸ ì‚¶ì˜ íƒœë„ê°€ ìœ¤ìˆ˜ì˜ ì–µì••ëœ ìš•ë§ì„ ì¼ê¹¨ìš°ë©° ì •ì„œì  ì—°ëŒ€ê°€ ê¹Šì–´ì§." }, "position": { "x": 704.4389830820649, "y": 657.4287792353512 }, "group": "nodes" },
  { "data": { "id": "TRB_06", "label": "TRB 06 ì¡°ë ¥ì ë“±ì¥", "color": "#4facfe", "notes": "ëª¨ì€. ê·¸ë…€ëŠ” ìœ¤ìˆ˜ê°€ ê°€ì§€ì§€ ëª»í•œ 'ê±°ì¹¨ì—†ëŠ” ì§„ì‹¤í•¨'ì„ ê°€ì§„ ì¸ë¬¼ë¡œ, ìœ¤ìˆ˜ê°€ ìì‹ ì˜ ê»ì§ˆì„ ê¹¨ê³  ë‚˜ì˜¤ë„ë¡ ë•ëŠ” ê±°ìš¸ ê°™ì€ ì¡´ì¬." }, "position": { "x": 414.41400088136925, "y": 827.4726023773557 }, "group": "nodes" },
  { "data": { "id": "STC_08", "label": "STC 08 ì¦ê±°ì›€ê³¼ ê²Œì„", "color": "#ffaa00", "notes": "ë‘ ì—¬ìì˜ ë³¸ê²©ì ì¸ ê³µì¡°. ëª¨ì€ì˜ ë³¸ëŠ¥ê³¼ ìœ¤ìˆ˜ì˜ ì§€ì„±ì´ ê²°í•©ë˜ì–´ ì ë“¤ì„ êµë€í•˜ê³  ì¦ê±°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” PRP_16(íˆ¬ìŸ)ì˜ ì¥ë¥´ì  ì¾Œê° êµ¬ê°„." }, "position": { "x": 743.3896977575515, "y": 764.067572979411 }, "group": "nodes" },
  { "data": { "id": "PRP_16", "label": "PRP 16 íˆ¬ìŸ", "color": "#667eea", "notes": "ì¦ê±°ë¥¼ ì¸ë©¸í•˜ë ¤ëŠ” í•˜ìˆ˜ì¸ë“¤ê³¼ì˜ ë¬¼ë¦¬ì  ì¶©ëŒ ë° ì •ë³´ì „. ìœ¤ìˆ˜ëŠ” ì´ ê³¼ì •ì—ì„œ ìì‹ ì˜ ìˆ¨ê²¨ì§„ ê°•ì¸í•¨ì„ ë°œê²¬í•¨." }, "position": { "x": 514.5399084727054, "y": 820.6519511653681 }, "group": "nodes" },
  { "data": { "id": "STC_09", "label": "STC 09 ë¯¸ë“œí¬ì¸íŠ¸", "color": "#ffaa00", "notes": "ì‚¬ê±´ì˜ ë°°í›„ì— êµ­ê°€ ê¶Œë ¥ í˜¹ì€ ê±°ëŒ€ ì¬ë‹¨ì´ ìˆìŒì„ ìê°. TRB_09(ì²« ê¹¨ë‹¬ìŒ)ê°€ ì¼ì–´ë‚˜ë©° ì‚¬ê±´ì´ ë” ì´ìƒ ê°œì¸ì˜ ë¬¸ì œê°€ ì•„ë‹˜ì„ ì¸ì§€." }, "position": { "x": 810.2301453772267, "y": 849.2792159251796 }, "group": "nodes" },
  { "data": { "id": "TRB_09", "label": "TRB 09 ì²« ê¹¨ë‹¬ìŒ", "color": "#4facfe", "notes": "ìì‹ ì´ ì«“ëŠ” ì§„ì‹¤ì´ ì„¸ìƒì„ ë’¤ì§‘ì„ ìˆ˜ ìˆì„ ë§Œí¼ ìœ„í—˜í•˜ë‹¤ëŠ” ê²ƒì„ ìê°. ë„ë§ì¹  ê²ƒì¸ê°€, ëê¹Œì§€ ê°ˆ ê²ƒì¸ê°€ì— ëŒ€í•œ ìš´ëª…ì  ì„ íƒ." }, "position": { "x": 586.2149319810069, "y": 994.8920590194255 }, "group": "nodes" },
  { "data": { "id": "STC_10", "label": "STC 10 ì•…ë‹¹ì˜ ì••ë°•", "color": "#ffaa00", "notes": "ì•…ë‹¹ë“¤ì´ ìœ¤ìˆ˜ì˜ ê°€ì¡±ì„ ìœ„í˜‘í•˜ê³  ëª¨ì€ì— ëŒ€í•œ ì˜ì‹¬ì„ ì‹¬ìŒ. PRP_21(ì¶”ê²©)ì´ ê·¹ëŒ€í™”ë˜ë©° ë‘ ì‚¬ëŒ ì‚¬ì´ì˜ ì‹ ë¢°ê°€ ì‹œí—˜ëŒ€ì— ì˜¤ë¦„." }, "position": { "x": 880.6336759391278, "y": 954.1057358007616 }, "group": "nodes" },
  { "data": { "id": "PRP_21", "label": "PRP 21 ì¶”ê²©", "color": "#667eea", "notes": "ë¬¼ë¦¬ì ì¸ ìœ„í˜‘ë¿ë§Œ ì•„ë‹ˆë¼ ìœ¤ìˆ˜ì˜ ê³¼ê±°ë¥¼ ì¡°ì‘í•˜ì—¬ ê·¸ë…€ë¥¼ ì‚¬íšŒì ìœ¼ë¡œ ì™„ì „íˆ ë§¤ì¥í•˜ë ¤ëŠ” ë°°í›„ ì„¸ë ¥ì˜ ì´ê³µì„¸." }, "position": { "x": 587.9684018538517, "y": 1105.7439688472493 }, "group": "nodes" },
  { "data": { "id": "STC_11", "label": "STC 11 ëª¨ë‘ ìƒì—ˆë‹¤", "color": "#ffaa00", "notes": "í™•ë³´í•œ ì¦ê±°ëŠ” ë¶ˆíƒ€ê³  ëª¨ì€ì€ ìì·¨ë¥¼ ê°ì¶¤. TRB_14(ê²‰ë³´ê¸° íŒ¨ë°°)ì™€ ë§ë¬¼ë ¤ ìœ¤ìˆ˜ëŠ” ë²•ì •ì—ì„œ ìœ ì£„ ì„ ê³  ì§ì „ì˜ íŒŒë©¸ ìƒíƒœì— ì´ë¦„." }, "position": { "x": 1037.1124131103195, "y": 1050.5632110372615 }, "group": "nodes" },
  { "data": { "id": "TRB_14", "label": "TRB 14 ê²‰ë³´ê¸° íŒ¨ë°°", "color": "#4facfe", "notes": "ëª¨ë“  í¬ë§ì´ ì‚¬ë¼ì§„ ì§€ì . ìì‹ ì˜ ë¬´ê²°í•¨ì— ì§‘ì°©í•˜ë˜ ìœ¤ìˆ˜ê°€ 'ì£„ì¸'ìœ¼ë¡œ ë‚™ì¸ì°íˆë©° ì‚¬íšŒì  ìì•„ê°€ ì™„ì „íˆ ì‚¬ë§í•¨." }, "position": { "x": 789.249092984122, "y": 1139.8494229930056 }, "group": "nodes" },
  { "data": { "id": "STC_12", "label": "STC 12 ì˜í˜¼ì˜ ì•”í‘ê¸°", "color": "#ffaa00", "notes": "ì–´ë‘  ì†ì—ì„œ ìì‹ ì˜ ìœ ë ¹(ì¹¨ë¬µí–ˆë˜ ê³¼ê±°)ê³¼ ë§ˆì£¼í•¨. TRB_15(ë‘ ë²ˆì§¸ ê¹¨ë‹¬ìŒ)ë¥¼ í†µí•´ ì§„ì§œ ì‹¸ì›€ì€ ë°–ì´ ì•„ë‹ˆë¼ ì•ˆì—ì„œ ì‹œì‘ë¨ì„ ìê°." }, "position": { "x": 1152.212270812847, "y": 1148.7799748353043 }, "group": "nodes" },
  { "data": { "id": "TRB_15", "label": "TRB 15 ë‘ ë²ˆì§¸ ê¹¨ë‹¬ìŒ", "color": "#4facfe", "notes": "ì™„ë²½í•´ì§€ë ¤ëŠ” ê°•ë°•ì„ ë²„ë¦´ ë•Œ ë¹„ë¡œì†Œ ììœ ë¡œì›Œì§„ë‹¤ëŠ” ì§„ë¦¬. ëª¨ì€ì´ ì™œ ê·¸í† ë¡ íŒŒê´´ì ìœ¼ë¡œ ì‚´ì•˜ëŠ”ì§€ ë¹„ë¡œì†Œ ì˜í˜¼ìœ¼ë¡œ ì´í•´í•¨." }, "position": { "x": 890.7344869718443, "y": 1229.3079348331626 }, "group": "nodes" },
  { "data": { "id": "STC_13", "label": "STC 13 3ë§‰ ì§„ì…", "color": "#ffaa00", "notes": "ëª¨ì€ì´ ë‚¨ê¸´ ë§ˆì§€ë§‰ ë°˜ê²©ì˜ ì¹´ë“œë¥¼ ë°œê²¬. PRP_25(ì–´ë ¤ìš´ ê³¼ì œ)ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ìŠ¤ìŠ¤ë¡œë¥¼ í¬ìƒí•  ì¤€ë¹„ë¥¼ ë§ˆì¹¨." }, "position": { "x": 1225.132734469043, "y": 1308.1121918060524 }, "group": "nodes" },
  { "data": { "id": "PRP_25", "label": "PRP 25 ì–´ë ¤ìš´ ê³¼ì œ", "color": "#667eea", "notes": "ìì‹ ì„ íŒŒë©¸ì‹œí‚¬ ìˆ˜ë„ ìˆëŠ” ì¹˜ëª…ì ì¸ ì§„ì‹¤(ìë°±)ì„ ëŒ€ì¤‘ ì•ì— í„°ëœ¨ë ¤ ì ë“¤ì˜ ìœ„ì„ ì„ í­ë¡œí•´ì•¼ í•˜ëŠ” ë‚œì œ." }, "position": { "x": 947.1798710043537, "y": 1376.5247978749717 }, "group": "nodes" },
  { "data": { "id": "STC_14", "label": "STC 14 í”¼ë‚ ë ˆ", "color": "#ffaa00", "notes": "í­ë°œì ì¸ 'ìë°±'. TRB_19(ê²°ì „)ì—ì„œ ì ë“¤ì„ ì••ë„í•˜ë©° ìì‹ ì˜ ì„±ì¥(ëª©ì†Œë¦¬)ì„ ì¦ëª…í•˜ê³  PRP_26(ê³¼ì œ í•´ê²°)ì„ í†µí•´ ì§„ì‹¤ì„ ìŠ¹ë¦¬ì‹œí‚´." }, "position": { "x": 1307.903639969555, "y": 1384.4755082012198 }, "group": "nodes" },
  { "data": { "id": "TRB_19", "label": "TRB 19 ê²°ì „", "color": "#4facfe", "notes": "ë°°í›„ì˜ ì •ì ì¸ ì¸ë¬¼ê³¼ ë²•ì • í˜¹ì€ ê³µê°œì  ì¥ì†Œì—ì„œ ëŒ€ë©´. ìœ¤ìˆ˜ëŠ” ë” ì´ìƒ ê³µí¬ì— ë–¨ì§€ ì•Šê³  ë…¼ë¦¬ì ì´ê³  ë‹¹ë‹¹í•˜ê²Œ ì ì˜ íŒŒë©¸ì„ ì„ ê³ í•¨." }, "position": { "x": 1027.811988488542, "y": 1501.577354194975 }, "group": "nodes" },
  { "data": { "id": "PRP_26", "label": "PRP 26 ê³¼ì œ í•´ê²°", "color": "#667eea", "notes": "ìœ¤ìˆ˜ì˜ ìë°±ì´ ì´‰ë§¤ê°€ ë˜ì–´ ìˆ¨ì–´ìˆë˜ ëª©ê²©ìë“¤ì´ ë“±ì¥í•˜ê³  ì¡°ì‘ëœ ì¦ê±°ë“¤ì´ ë¬´ë ¥í™”ë˜ëŠ” ì„œì‚¬ì  í•´ì†Œ." }, "position": { "x": 1215.1850205835167, "y": 1573.239429750546 }, "group": "nodes" },
  { "data": { "id": "STC_15", "label": "STC 15 ì—”ë”© ì´ë¯¸ì§€", "color": "#ffaa00", "notes": "ë‹¤ì‹œ ìº”ë²„ìŠ¤ ì•ì— ì„  ìœ¤ìˆ˜. ì´ì œ ê·¸ë…€ëŠ” ê±°ì¹¨ì—†ì´ ìì‹ ë§Œì˜ ìƒ‰ì„ ì¹ í•˜ë©°, TRB_22(ìƒˆë¡œìš´ ê· í˜•) ì†ì—ì„œ ëª¨ì€ê³¼ ë‚˜ë€íˆ ì„œì„œ ìˆ˜í‰ì„ ì„ ë°”ë¼ë´„." }, "position": { "x": 1498.3224594594258, "y": 1553.8353509063081 }, "group": "nodes" },
  { "data": { "id": "TRB_22", "label": "TRB 22 ìƒˆë¡œìš´ ê· í˜•", "color": "#4facfe", "notes": "ì§„ì‹¤ì˜ ëŒ€ê°€ë¥¼ ì¹˜ë¥¸ í›„ ì–»ì€ ì§„ì •í•œ ììœ . ê³¼ê±°ì˜ ì¹¨ë¬µí•˜ë˜ êµì‚¬ëŠ” ì£½ê³ , ì§„ì‹¤ì„ ë§í•˜ëŠ” ì˜ˆìˆ ê°€ë¡œì„œì˜ ì‚¶ì´ ì‹œì‘ë¨." }, "position": { "x": 1448.996404753789, "y": 1661.412327358025 }, "group": "nodes" },
  { "data": { "id": "EP_01", "label": "01í™”: ë¬´ì±„ìƒ‰ì˜ ê· ì—´", "color": "#e91e63", "notes": "[STC_01: ì˜¤í”„ë‹] ë¯¸ìˆ êµì‚¬ ìœ¤ìˆ˜ì˜ ê³ ë¦½ëœ ì¼ìƒì— ëª¨ì€ì´ ê°•ë ¬í•˜ê²Œ ì¹¨ì…í•©ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ì •ì ì¸ ê³µê°„ì— ë²ˆì§€ëŠ” ëª¨ì€ì˜ ì´ì§ˆì ì¸ ì—ë„ˆì§€. ì—”ë”© ì ˆë²½: ìœ¤ìˆ˜ì˜ ì§‘ ê±°ì‹¤ì—ì„œ ë°œê²¬ëœ ì •ì²´ë¶ˆëª…ì˜ ì‚¬ì²´ì™€ ëˆ„ëª…ì˜ ì‹œì‘." }, "position": { "x": 428.4433293458169, "y": -93.9349463878475 }, "group": "nodes" },
  { "data": { "id": "EP_02", "label": "02í™”: ì•…ë§ˆì˜ ê³„ì•½", "color": "#e91e63", "notes": "[STC_04: ì´‰ë§¤ ì‚¬ê±´] ìœ ë ¥ ìš©ì˜ìê°€ ëœ ìœ¤ìˆ˜ ì•ì— ëª¨ì€ì´ ì•Œë¦¬ë°”ì´ë¥¼ ì¥ê³  ë‚˜íƒ€ë‚©ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ì·¨ì¡°ì‹¤ì—ì„œ ëª¨ì€ì´ ì œì•ˆí•˜ëŠ” ìœ„í—˜í•œ ê±°ë˜ 'ë‚˜ë¥¼ ë¯¿ìœ¼ë©´ ì‚´ë ¤ì¤„ê²Œ'. ì—”ë”© ì ˆë²½: ìœ¤ìˆ˜ê°€ ìì‹ ì˜ ì¸ìƒì„ ëª¨ì€ì—ê²Œ ë§¡ê¸°ë©° ê³„ì•½ì„ ì²´ê²°í•˜ëŠ” ìˆœê°„." }, "position": { "x": 525.4733109154948, "y": -18.826136664994287 }, "group": "nodes" },
  { "data": { "id": "EP_03", "label": "03í™”: ê¸ˆê¸°ëœ ë™í–‰", "color": "#e91e63", "notes": "[STC_05: ê³ ë¯¼/ì €í•­] ì‹œìŠ¤í…œ ì•ˆì—ì„œì˜ í•´ê²°ì„ í¬ê¸°í•˜ê³  ë²•ë§ ë°–ìœ¼ë¡œ ë‚˜ê°€ëŠ” ê°ˆë“±. í›„í‚¹ í¬ì¸íŠ¸: ê²½ì°° ì´ì†¡ ì¤‘ ë²Œì–´ì§€ëŠ” ê¸´ë°•í•œ íƒˆì£¼ ì‹œí€€ìŠ¤. ì—”ë”© ì ˆë²½: ì•ˆì „í•œ ê³³ì¸ ì¤„ ì•Œì•˜ìœ¼ë‚˜ ëª¨ì€ì´ ìœ¤ìˆ˜ì˜ ëª©ì— ì¹¼ì„ ê²¨ëˆ„ë©° ë“œëŸ¬ë‚´ëŠ” ì‹¸ëŠ˜í•œ ë³¸ìƒ‰." }, "position": { "x": 639.4994931127095, "y": 89.65334408920673 }, "group": "nodes" },
  { "data": { "id": "EP_04", "label": "04í™”: ì„ ì„ ë„˜ëŠ” ì", "color": "#e91e63", "notes": "[STC_06: 2ë§‰ ì§„ì…] ì£¼ì¸ê³µì´ ìˆ˜ë™ì„±(TRB_03)ì„ ë²„ë¦¬ê³  ì ê·¹ì ìœ¼ë¡œ ë³€ëª¨í•©ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ì•ˆê²½ì„ ë²—ê³  ë¨¸ë¦¬ë¥¼ ë¬¶ìœ¼ë©° ì ì—ê²Œ ì²˜ìŒìœ¼ë¡œ ë°˜ê²©í•˜ëŠ” ìœ¤ìˆ˜ì˜ ì‹œê°ì  ë³€í™”. ì—”ë”© ì ˆë²½: ë°°í›„ ì„¸ë ¥ì˜ í•˜ìˆ˜ì¸ì„ ì œì••í•œ ìˆœê°„, ëª¨ì€ì´ ê·¸ë¥¼ ì£½ì´ë ¤ëŠ” ìœ¤ìˆ˜ë¥¼ ê°€ë¡œë§‰ìœ¼ë©° ë°œìƒí•˜ëŠ” ì˜ë¬¸." }, "position": { "x": 712.3467926436482, "y": 203.49202357141453 }, "group": "nodes" },
  { "data": { "id": "EP_05", "label": "05í™”: ìƒì²˜ì˜ ê³µìœ ", "color": "#e91e63", "notes": "[STC_07: BìŠ¤í† ë¦¬] ë‘ ì—¬ìì˜ ì •ì„œì  ì—°ëŒ€ê°€ ê¹Šì–´ì§€ëŠ” êµ¬ê°„ì…ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: íì°½ê³  ë°¤ìƒ˜ ì¤‘ ë“œëŸ¬ë‚˜ëŠ” ì„œë¡œì˜ ê³¼ê±° ìƒì²˜(ìœ ë ¹)ì™€ ê¸°ë¬˜í•œ ê³µê°ëŒ€. ì—”ë”© ì ˆë²½: ëª¨ì€ì˜ ê°€ë°© ê¹Šìˆ™í•œ ê³³ì—ì„œ ë°œê²¬ëœ ìœ¤ìˆ˜ì˜ ì–´ë¦° ì‹œì ˆ ì‚¬ì§„. 'ë„ˆ ë‚˜ë¥¼ ì•Œê³  ìˆì—ˆì–´?'" }, "position": { "x": 726.8744995619289, "y": 343.6888474738975 }, "group": "nodes" },
  { "data": { "id": "EP_06", "label": "06í™”: í™”ë ¤í•œ ì ì…", "color": "#e91e63", "notes": "[STC_08: ì¦ê±°ì›€ê³¼ ê²Œì„] ì¥ë¥´ì  ì¾Œê°ì´ ê·¹ëŒ€í™”ë˜ëŠ” ê³µì¡° êµ¬ê°„. í›„í‚¹ í¬ì¸íŠ¸: ìƒë¥˜ì¸µ ìì„  íŒŒí‹°ì— ë“œë ˆìŠ¤ë¥¼ ì…ê³  ì ì…í•˜ì—¬ ì¦ê±°ë¥¼ íƒˆì·¨í•˜ëŠ” ì¼€ì´í¼ ë¬´ë¹„ì  ì „ê°œ. ì—”ë”© ì ˆë²½: ì¦ê±°ë¥¼ ì†ì— ë„£ê³  íƒˆì¶œí•˜ë ¤ëŠ” ì°°ë‚˜, ìœ¤ìˆ˜ì˜ ëˆˆì•ì—ì„œ ê´´í•œë“¤ì—ê²Œ ë‚©ì¹˜ë‹¹í•˜ëŠ” ëª¨ì€." }, "position": { "x": 834.2954777745368, "y": 437.9628542221389 }, "group": "nodes" },
  { "data": { "id": "EP_07", "label": "07í™”: ì„¤ê³„ëœ ì§„ì‹¤", "color": "#e91e63", "notes": "[STC_09: ë¯¸ë“œí¬ì¸íŠ¸] ì‚¬ê±´ì˜ ê±°ëŒ€í•œ ë°°í›„ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ë°°í›„ì˜ ëª¸í†µì´ ìœ¤ìˆ˜ê°€ ê°€ì¥ ì‹ ë¢°í–ˆë˜ ì€ì‚¬ë¼ëŠ” ì¶©ê²©ì  ë°˜ì „. ì—”ë”© ì ˆë²½: ì€ì‚¬ê°€ ê±´ë„¨ íŒŒì¼ ì† ëª¨ì€ì˜ ì†Œë¦„ ë‹ëŠ” ê³¼ê±° ì‚´ì¸ ì „ê³¼ ê¸°ë¡. 'ëˆ„ê°€ ì§„ì§œ ì•…ë§ˆì¼ê¹Œ?'" }, "position": { "x": 869.1351268115499, "y": 659.6396717604316 }, "group": "nodes" },
  { "data": { "id": "EP_08", "label": "08í™”: ì‹ ë¢°ì˜ íŒŒí¸", "color": "#e91e63", "notes": "[STC_10: ì•…ë‹¹ì˜ ì••ë°•] ì•…ë‹¹ë“¤ì´ ì‹¬ì–´ë†“ì€ ì´ê°„ì§ˆ(PRP_21)ë¡œ ë‘ ì‚¬ëŒì˜ ê´€ê³„ê°€ ê· ì—´ë©ë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ì„œë¡œì—ê²Œ ì´êµ¬ë¥¼ ê²¨ëˆ„ë“¯ ë‚ ì¹´ë¡­ê²Œ ì˜ì•„ë¶™ì´ëŠ” ì‹¬ë¦¬ ëŒ€ë¦½. ì—”ë”© ì ˆë²½: ìœ¤ìˆ˜ë¥¼ ì‚¬ì§€ë¡œ ëª°ë ¤ëŠ” ì€ì‚¬ë¥¼ ë§‰ê¸° ìœ„í•´ ìŠ¤ìŠ¤ë¡œ ì‚´ì¸ì£„ë¥¼ ë’¤ì§‘ì–´ì“°ê³  ì ˆë²½ ì•„ë˜ë¡œ ì‚¬ë¼ì§€ëŠ” ëª¨ì€." }, "position": { "x": 976.4222419538903, "y": 769.527324350608 }, "group": "nodes" },
  { "data": { "id": "EP_09", "label": "09í™”: ì˜í˜¼ì˜ íŒŒë©¸", "color": "#e91e63", "notes": "[STC_11: ëª¨ë‘ ìƒì—ˆë‹¤] ì¡°ë ¥ìë„ ì¦ê±°ë„ ì—†ëŠ” ì£¼ì¸ê³µì˜ ê°€ì¥ ì°¸ë‹´í•œ ìƒíƒœ. í›„í‚¹ í¬ì¸íŠ¸: ë²•ì •ì—ì„œ ì‚¬í˜• êµ¬í˜•ì„ ë¬´ê¸°ë ¥í•˜ê²Œ ë“£ê³  ìˆëŠ” ìœ¤ìˆ˜ì˜ íŒŒë©¸ëœ ëˆˆë¹›. ì—”ë”© ì ˆë²½: ë©´íšŒì‹¤ ìŠ¤í”¼ì»¤ë¥¼ í†µí•´ ë“¤ë ¤ì˜¤ëŠ” ìµìˆ™í•œ ë…¸ë«ì†Œë¦¬. ì£½ì€ ì¤„ ì•Œì•˜ë˜ ëª¨ì€ì´ ì‚´ì•„ìˆë‹¤ëŠ” ìƒì¡´ ì‹ í˜¸." }, "position": { "x": 1015.3190948272265, "y": 844.5886021587072 }, "group": "nodes" },
  { "data": { "id": "EP_10", "label": "10í™”: ì–´ë‘  ì†ì˜ ë¹›", "color": "#e91e63", "notes": "[STC_12: ì˜í˜¼ì˜ ì•”í‘ê¸°] ë‚´ì  ì„±ì°°ì„ í†µí•´ ë°˜ê²©ì˜ ì‹¤ë§ˆë¦¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤. í›„í‚¹ í¬ì¸íŠ¸: ëª¨ì€ì˜ ìŠ¤ì¼€ì¹˜ë¶ì— ìˆ¨ê²¨ì§„ ì•”í˜¸ë¥¼ í’€ë©° ì ì˜ ìœ„ì„ ì„ í­ë¡œí•  ì „ëµ ìˆ˜ë¦½. ì—”ë”© ì ˆë²½: ìì‹ ì˜ ê²°ë°±ì´ ì•„ë‹Œ 'ì ì˜ ìœ ì£„'ë¥¼ ì¦ëª…í•˜ê¸° ìœ„í•´ ëŒ€ì¤‘ ì•ì—ì„œì˜ 'ìë°± ë°©ì†¡'ì„ ì„ í¬í•˜ëŠ” ìœ¤ìˆ˜." }, "position": { "x": 1195.5578501055898, "y": 978.577007479898 }, "group": "nodes" },
  { "data": { "id": "EP_11", "label": "11í™”: ë§ˆì§€ë§‰ ìë°±", "color": "#e91e63", "notes": "[STC_14: í”¼ë‚ ë ˆ] ì¤€ë¹„ëœ ëª¨ë“  í¼ì¦ì´ ë§ì¶°ì§€ëŠ” ê±°ëŒ€í•œ ê²°ì „. í›„í‚¹ í¬ì¸íŠ¸: ì¬íŒì¥ì—ì„œ ëª¨ë“  ì¹´ë©”ë¼ë¥¼ ì‘ì‹œí•˜ë©° ìŸì•„ë‚´ëŠ” ìœ¤ìˆ˜ì˜ íŒŒê²©ì ì´ê³  ë…¼ë¦¬ì ì¸ í­ë¡œ. ì—”ë”© ì ˆë²½: í”¼ê³ ì¸ì„ì˜ ìœ¤ìˆ˜ê°€ ë°©ì²­ì„ êµ¬ì„ì˜ ë‚¯ì„  ì—¬ìë¥¼ ë³´ë©° ë¯¸ì†Œ ì§“ëŠ” ì°°ë‚˜, ë²•ì •ì— ìš¸ë ¤ í¼ì§€ëŠ” ëª¨ì€ì˜ ëª©ì†Œë¦¬." }, "position": { "x": 1369.071402890311, "y": 1084.9427282234913 }, "group": "nodes" },
  { "data": { "id": "EP_12", "label": "12í™”: ëŒ€ê°€ì˜ ë", "color": "#e91e63", "notes": "[STC_15: ì—”ë”© ì´ë¯¸ì§€] ì§„ì‹¤ì˜ ëŒ€ê°€ë¥¼ ì¹˜ë¥¸ í›„ ì–»ì€ í‰í™”. í›„í‚¹ í¬ì¸íŠ¸: ë¬´ë„ˆì§€ëŠ” ê¶Œë ¥ìë“¤ì˜ ëª°ë½ê³¼ ë¹„ë¡œì†Œ ì™„ì„±ëœ ìœ¤ìˆ˜ì˜ ê°•ë ¬í•œ ë¶‰ì€ íšŒí™”. ì—”ë”© ì ˆë²½: ìˆ˜í‰ì„  ë„ˆë¨¸ë¡œ í•¨ê»˜ ê±¸ì–´ê°€ëŠ” ìœ¤ìˆ˜ì™€ ëª¨ì€ì˜ ë’·ëª¨ìŠµ. 'ì´ì œ ìš°ë¦° ì–´ë””ë¡œ ê°€?'" }, "position": { "x": 1630.9962069291687, "y": 1139.4756479581474 }, "group": "nodes" },
  { "data": { "id": "E_S1_T2", "source": "STC_01", "target": "TRB_02", "label": "ì–µì••ëœ ì˜¤í”„ë‹ ì´ë¯¸ì§€ëŠ” ê³¼ê±°ì˜ ìœ ë ¹(ì¹¨ë¬µ)ì— ê·¼ê±°í•¨" }, "group": "edges" },
  { "data": { "id": "E_S2_T3", "source": "STC_02", "target": "TRB_03", "label": "í…Œë§ˆì˜ ì§ˆë¬¸ì´ ì¸ë¬¼ì˜ ë‚´ì  ì•½ì ê³¼ ê²°í•ì„ ìê·¹í•¨" }, "group": "edges" },
  { "data": { "id": "E_S3_P1", "source": "STC_03", "target": "PRP_01", "label": "ì„¸íŠ¸ì—…ì—ì„œ ë³´ì—¬ì¤€ ë¶ˆì•ˆí•œ í‰í™”ëŠ” ë³´í˜¸ìì˜ ë¶€ì¬ë¡œ ì¸í•´ ìœ„íƒœë¡œì›€" }, "group": "edges" },
  { "data": { "id": "E_S4_P8", "source": "STC_04", "target": "PRP_08", "label": "ì‚¬ê±´ ë°œìƒì´ ê³§ ì£¼ì¸ê³µì˜ ê·¼ì›ì  ê²°í•(ëˆ„ëª…)ìœ¼ë¡œ ì´ì–´ì§" }, "group": "edges" },
  { "data": { "id": "E_P8_P9", "source": "PRP_08", "target": "PRP_09", "label": "ì‚¬íšŒì  íŒŒë©¸(ê²°í•) ìƒíƒœì—ì„œ ëª¨ì€ì˜ ìœ„í—˜í•œ ì œì•ˆì´ ìœ ì¼í•œ í•´ê²°ì±…ì´ ë¨" }, "group": "edges" },
  { "data": { "id": "E_S6_T5", "source": "STC_06", "target": "TRB_05", "label": "2ë§‰ ì§„ì… ê²°ë‹¨ì´ ìˆ˜ë™ì  ì¸ë¬¼ì„ ëŠ¥ë™ì  ìš•ë§ì„ ê°€ì§„ ìë¡œ ë³€í™”ì‹œí‚´" }, "group": "edges" },
  { "data": { "id": "E_S7_T6", "source": "STC_07", "target": "TRB_06", "label": "BìŠ¤í† ë¦¬ì˜ í•µì‹¬ì€ ì¡°ë ¥ì ëª¨ì€ê³¼ì˜ ì •ì„œì  ê³µëª…ê³¼ êµê°ì„" }, "group": "edges" },
  { "data": { "id": "E_S8_P16", "source": "STC_08", "target": "PRP_16", "label": "ê³µì¡°ë¥¼ í†µí•œ ì¦ê±°ì›€ê³¼ ê²Œì„ êµ¬ê°„ì´ êµ¬ì²´ì  íˆ¬ìŸìœ¼ë¡œ ë‚˜íƒ€ë‚¨" }, "group": "edges" },
  { "data": { "id": "E_S9_T9", "source": "STC_09", "target": "TRB_09", "label": "ì™¸ì  ìœ„ê¸°ì˜ ì •ì ì´ ì£¼ì¸ê³µì˜ ë‚´ì  ê°€ì¹˜ê´€ ì „í™˜ì„ ì´‰ë°œí•¨" }, "group": "edges" },
  { "data": { "id": "E_S10_P21", "source": "STC_10", "target": "PRP_21", "label": "ì•…ë‹¹ì˜ ì „ë°©ìœ„ì  ì••ë°•ì´ êµ¬ì²´ì ì¸ ë¬¼ë¦¬ì  ì¶”ê²©ì „ìœ¼ë¡œ ì „ê°œë¨" }, "group": "edges" },
  { "data": { "id": "E_S11_T14", "source": "STC_11", "target": "TRB_14", "label": "ì™¸ì  ìƒì‹¤(ëª¨ë“  ì¦ê±° ì†Œë©¸)ì´ ì¸ë¬¼ì˜ ì™„ì „í•œ íŒ¨ë°°ê°ìœ¼ë¡œ ì§ê²°ë¨" }, "group": "edges" },
  { "data": { "id": "E_S12_T15", "source": "STC_12", "target": "TRB_15", "label": "ì•”í‘ê¸° ì†ì˜ ê³ í†µìŠ¤ëŸ¬ìš´ ì„±ì°°ì´ ë°˜ê²©ì„ ìœ„í•œ ë‚´ì  ê¹¨ë‹¬ìŒì„ ì¤Œ" }, "group": "edges" },
  { "data": { "id": "E_S13_P25", "source": "STC_13", "target": "PRP_25", "label": "3ë§‰ì˜ ë¹„ì¥í•œ ê²°ë‹¨ì´ í•´ê²°í•´ì•¼ í•  ë§ˆì§€ë§‰ ë‚œê´€ìœ¼ë¡œ ì—°ê²°ë¨" }, "group": "edges" },
  { "data": { "id": "E_S14_T19", "source": "STC_14", "target": "TRB_19", "label": "í”¼ë‚ ë ˆì˜ í­ë°œë ¥ì´ ì£¼ì¸ê³µì˜ ë‚´ì  ìŠ¹ë¦¬ì™€ ì£¼ì²´ì  ì„±ì¥ì„ ì™„ì„±í•¨" }, "group": "edges" },
  { "data": { "id": "E_S14_P26", "source": "STC_14", "target": "PRP_26", "label": "í”¼ë‚ ë ˆì˜ í–‰ë™ì´ ì„œì‚¬ì  ë‚œì œë¥¼ ê¸°ìˆ ì ìœ¼ë¡œ í•´ê²°í•˜ê³  ë‹¨ì£„í•¨" }, "group": "edges" },
  { "data": { "id": "E_S15_T22", "source": "STC_15", "target": "TRB_22", "label": "ì—”ë”©ì˜ ììœ ë¡œìš´ ì´ë¯¸ì§€ê°€ ì¸ë¬¼ì˜ ë³€í™”ëœ ë‚´ì  ê· í˜•ì„ ì…ì¦í•¨" }, "group": "edges" },
  { "data": { "id": "S1_S2", "source": "STC_01", "target": "STC_02" }, "group": "edges" },
  { "data": { "id": "S2_S3", "source": "STC_02", "target": "STC_03" }, "group": "edges" },
  { "data": { "id": "S3_S4", "source": "STC_03", "target": "STC_04" }, "group": "edges" },
  { "data": { "id": "S4_S5", "source": "STC_04", "target": "STC_05" }, "group": "edges" },
  { "data": { "id": "S5_S6", "source": "STC_05", "target": "STC_06" }, "group": "edges" },
  { "data": { "id": "S6_S7", "source": "STC_06", "target": "STC_07" }, "group": "edges" },
  { "data": { "id": "S7_S8", "source": "STC_07", "target": "STC_08" }, "group": "edges" },
  { "data": { "id": "S8_S9", "source": "STC_08", "target": "STC_09" }, "group": "edges" },
  { "data": { "id": "S9_S10", "source": "STC_09", "target": "STC_10" }, "group": "edges" },
  { "data": { "id": "S10_S11", "source": "STC_10", "target": "STC_11" }, "group": "edges" },
  { "data": { "id": "S11_S12", "source": "STC_11", "target": "STC_12" }, "group": "edges" },
  { "data": { "id": "S12_S13", "source": "STC_12", "target": "STC_13" }, "group": "edges" },
  { "data": { "id": "S13_S14", "source": "STC_13", "target": "STC_14" }, "group": "edges" },
  { "data": { "id": "S14_S15", "source": "STC_14", "target": "STC_15" }, "group": "edges" },
  { "data": { "id": "EP_01_02", "source": "EP_01", "target": "EP_02" }, "group": "edges" },
  { "data": { "id": "EP_02_03", "source": "EP_02", "target": "EP_03" }, "group": "edges" },
  { "data": { "id": "EP_03_04", "source": "EP_03", "target": "EP_04" }, "group": "edges" },
  { "data": { "id": "EP_04_05", "source": "EP_04", "target": "EP_05" }, "group": "edges" },
  { "data": { "id": "EP_05_06", "source": "EP_05", "target": "EP_06" }, "group": "edges" },
  { "data": { "id": "EP_06_07", "source": "EP_06", "target": "EP_07" }, "group": "edges" },
  { "data": { "id": "EP_07_08", "source": "EP_07", "target": "EP_08" }, "group": "edges" },
  { "data": { "id": "EP_08_09", "source": "EP_08", "target": "EP_09" }, "group": "edges" },
  { "data": { "id": "EP_09_10", "source": "EP_09", "target": "EP_10" }, "group": "edges" },
  { "data": { "id": "EP_10_11", "source": "EP_10", "target": "EP_11" }, "group": "edges" },
  { "data": { "id": "EP_11_12", "source": "EP_11", "target": "EP_12" }, "group": "edges" }
 ];

    let cy = cytoscape({
      container: document.getElementById('cy'),
      elements: JSON.parse(JSON.stringify(initialData)),
      style: [
        { selector: 'node', style: { 'label': 'data(label)', 'background-color': 'data(color)', 'shape': 'round-rectangle', 'width': 'label', 'height': 30, 'padding': '10px', 'border-width': 2, 'border-color': '#333', 'border-style': 'solid', 'text-valign': 'center', 'text-halign': 'center', 'color': '#fff', 'font-weight': 'bold', 'font-size': 14, 'text-outline-width': 2, 'text-outline-color': '#000' } },
        { selector: 'edge', style: { 'label': 'data(label)', 'curve-style': 'bezier', 'line-color': '#999', 'width': 1, 'target-arrow-shape': 'triangle', 'target-arrow-color': '#999', 'font-size': 12 } },
        { selector: 'edge.timeline', style: { 'line-color': '#ff0055', 'width': 3, 'target-arrow-color': '#ff0055' } },
        { selector: 'node:selected', style: { 'border-width': 4, 'border-color': '#FFD700', 'border-style': 'double' } },
        { selector: 'edge:selected', style: { 'width': 4, 'line-color': '#FFD700', 'target-arrow-color': '#FFD700' } }
      ],
      layout: { name: 'cose', animate: true },
      boxSelectionEnabled: false
    });

    let selected = null, speechSynthesis = window.speechSynthesis, currentUtterance = null;
    let edgeCreationMode = false, edgeSourceNode = null, isDragMode = false, tremorInterval = null, currentLayout = null;

    const notesInfo = document.getElementById('notesInfo');
    const labelInput = document.getElementById('labelInput');
    const colorControl = document.getElementById('colorControl');
    const colorInput = document.getElementById('colorInput');
    const notesTextarea = document.getElementById('notesTextarea');
    const edgeSrcInput = document.getElementById('edgeSrc');
    const edgeTgtInput = document.getElementById('edgeTgt');

    window.addEventListener('load', function () {
      const hash = window.location.hash.substring(1);
      if (hash) { try { cy.elements().remove(); cy.add(JSON.parse(LZString.decompressFromEncodedURIComponent(hash))); runLayout('cose'); } catch (e) {} }
      else runLayout('cose');
      resetRightPanel();
    });

    // ------------------- â–¼ í•µì‹¬: ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ â–¼ -------------------
    
    // 1. ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
    function deleteSelected() {
      if (!selected) { alert('ì‚­ì œí•  ìš”ì†Œë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
      
      const element = cy.getElementById(selected.id);
      if (element.length === 0) return;

      const confirmMsg = selected.type === 'node' 
        ? `'${element.data('label')}' ë…¸ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì—°ê²°ëœ ëª¨ë“  ì„ ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)` 
        : `'${element.data('label') || 'ê´€ê³„'}' ì„ ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;

      if (confirm(confirmMsg)) {
        cy.remove(element);
        resetRightPanel(); // íŒ¨ë„ ì´ˆê¸°í™”
        // ì—°ê²° ì…ë ¥ì°½ì— ì‚­ì œëœ ë…¸ë“œê°€ ìˆë‹¤ë©´ ì´ˆê¸°í™”
        if (edgeSrcInput.value === selected.id || edgeTgtInput.value === selected.id) {
            clearEdgeInputs();
        }
        selected = null;
      }
    }

    // 2. í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Delete, Backspace) ë¦¬ìŠ¤ë„ˆ
    document.addEventListener('keydown', function(event) {
        // ì…ë ¥ì°½(input, textarea)ì—ì„œ íƒ€ì´í•‘ ì¤‘ì¼ ë•ŒëŠ” ì‚­ì œ í‚¤ ë™ì‘ ì•ˆ í•¨ (ê¸€ì ì§€ì›Œì•¼ í•˜ë‹ˆê¹Œ)
        const tag = document.activeElement.tagName.toUpperCase();
        if (tag === 'INPUT' || tag === 'TEXTAREA') return;

        if (event.key === 'Delete' || event.key === 'Backspace') {
            if (selected) {
                deleteSelected();
            }
        }
    });

    // ------------------- â–² í•µì‹¬: ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ â–² -------------------


    function toggleDragMode() {
        isDragMode = !isDragMode;
        const btn = document.getElementById('btnDragMode');
        if (isDragMode) {
            btn.classList.add('drag-mode-active');
            btn.innerText = "ğŸ–±ï¸ ë“œë˜ê·¸ ëª¨ë“œ ON (ë…¸ë“œë¥¼ ì¡ê³  ë„ì„¸ìš”)";
            cy.userZoomingEnabled(false); cy.userPanningEnabled(false);
        } else {
            btn.classList.remove('drag-mode-active');
            btn.innerText = "ğŸ–±ï¸ ë“œë˜ê·¸ ì—°ê²° ëª¨ë“œ (ì¼œê¸°/ë„ê¸°)";
            cy.userZoomingEnabled(true); cy.userPanningEnabled(true);
        }
    }

    function resetRightPanel() {
        selected = null;
        notesInfo.innerText = "ë…¸ë“œ/ì—£ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”";
        labelInput.value = ''; notesTextarea.value = '';
        labelInput.disabled = true; notesTextarea.disabled = true;
        colorControl.style.display = 'none';
    }

    cy.on('tap', 'node', function (evt) {
      const node = evt.target; const nodeId = node.id();
      if (!isDragMode) {
          if (edgeSrcInput.value === '') { edgeSrcInput.value = nodeId; node.animate({ style: { 'border-color': '#4facfe', 'border-width': 4 } }, { duration: 200 }); }
          else if (edgeTgtInput.value === '' && edgeSrcInput.value !== nodeId) { edgeTgtInput.value = nodeId; node.animate({ style: { 'border-color': '#ff0055', 'border-width': 4 } }, { duration: 200 }); }
      }
      selected = { type: 'node', id: nodeId };
      notesInfo.innerText = "ë…¸ë“œ: " + nodeId;
      labelInput.value = node.data('label') || ''; notesTextarea.value = node.data('notes') || '';
      labelInput.disabled = false; notesTextarea.disabled = false;
      colorControl.style.display = 'block'; colorInput.value = node.data('color') || '#667eea';
    });

    cy.on('tap', 'edge', function (evt) {
      const edge = evt.target;
      selected = { type: 'edge', id: edge.id() };
      notesInfo.innerText = "ê´€ê³„: " + edge.data('source') + " â†’ " + edge.data('target');
      labelInput.value = edge.data('label') || ''; notesTextarea.value = edge.data('notes') || '';
      labelInput.disabled = false; notesTextarea.disabled = false;
      colorControl.style.display = 'none';
    });

    cy.on('tap', function(evt){ if(evt.target === cy){ resetRightPanel(); } });

    cy.on('dbltap', function (evt) {
      if (evt.target === cy) {
        const pos = evt.position, nodeName = prompt("ìƒˆ ë…¸ë“œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "ìƒˆ ë…¸ë“œ");
        if (nodeName && nodeName.trim()) {
          const id = nodeName.trim();
          if (cy.getElementById(id).length > 0) { alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!"); return; }
          const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
          cy.add({ data: { id: id, label: id, color: colors[Math.floor(Math.random() * colors.length)], notes: "" }, position: { x: pos.x, y: pos.y } });
          stopObsidianTremor(); startObsidianTremor();
        }
      }
    });

    cy.on('mousedown', 'node', function (evt) {
      if (evt.originalEvent.ctrlKey || evt.originalEvent.metaKey || isDragMode) {
        edgeCreationMode = true; edgeSourceNode = evt.target;
        evt.target.style({ 'border-width': '4px', 'border-color': '#43e97b', 'border-style': 'dashed' });
      }
    });
    cy.on('mouseover', 'node', function (evt) { if (edgeCreationMode && edgeSourceNode && evt.target.id() !== edgeSourceNode.id()) evt.target.style({ 'border-width': '4px', 'border-color': '#4facfe' }); });
    cy.on('mouseout', 'node', function (evt) { if (edgeCreationMode && edgeSourceNode && evt.target.id() !== edgeSourceNode.id()) evt.target.style('border-width', '2px'); });
    cy.on('mouseup', 'node', function (evt) {
      if (edgeCreationMode && edgeSourceNode && evt.target.id() !== edgeSourceNode.id()) {
        const label = prompt("ê´€ê³„ ë¼ë²¨ ì…ë ¥:", "");
        if (label !== null) {
          let classes = (label && (label.toUpperCase() === "TIMELINE" || label.toUpperCase() === "íƒ€ì„ë¼ì¸")) ? "timeline" : "";
          cy.add({ data: { id: edgeSourceNode.id() + "_" + evt.target.id() + "_" + Date.now(), source: edgeSourceNode.id(), target: evt.target.id(), label: label || "", notes: "" }, classes: classes });
          stopObsidianTremor(); startObsidianTremor();
        }
        edgeSourceNode.style('border-width', '2px'); edgeCreationMode = false; edgeSourceNode = null;
      }
    });
    cy.on('mouseup', function (evt) { if (edgeCreationMode && evt.target === cy) { if (edgeSourceNode) edgeSourceNode.style('border-width', '2px'); edgeCreationMode = false; edgeSourceNode = null; } });

    function clearEdgeInputs() { edgeSrcInput.value = ''; edgeTgtInput.value = ''; document.getElementById('edgeLbl').value = ''; }
    function swapEdgeInputs() { const temp = edgeSrcInput.value; edgeSrcInput.value = edgeTgtInput.value; edgeTgtInput.value = temp; }
    function addEdge() {
      const src = edgeSrcInput.value.trim(), tgt = edgeTgtInput.value.trim(), lbl = document.getElementById('edgeLbl').value.trim();
      if (!src || !tgt) { alert('ë…¸ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”!'); return; }
      if (cy.getElementById(src).length === 0 || cy.getElementById(tgt).length === 0) { alert('ë…¸ë“œê°€ ì—†ìŠµë‹ˆë‹¤!'); return; }
      let classes = (lbl && (lbl.toUpperCase() === "TIMELINE" || lbl.toUpperCase() === "íƒ€ì„ë¼ì¸")) ? "timeline" : "";
      cy.add({ data: { id: src + "_" + tgt + "_" + Date.now(), source: src, target: tgt, label: lbl || "", notes: "" }, classes: classes });
      runLayout('cose'); document.getElementById('edgeLbl').value = '';
    }

    function addNode() {
      const id = document.getElementById('newNode').value.trim();
      if (!id) { alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!'); return; }
      if (cy.getElementById(id).length > 0) { alert('ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤!'); return; }
      const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
      cy.add({ data: { id: id, label: id, color: colors[Math.floor(Math.random() * colors.length)], notes: "" } });
      runLayout('cose'); document.getElementById('newNode').value = '';
    }

    function startObsidianTremor() {
      if (tremorInterval) return;
      tremorInterval = setInterval(() => {
        cy.nodes().forEach(node => {
            if(node.selected()) return;
            const degree = node.degree(); const tremorStrength = 5.0 / (1 + degree);
            node.position({ x: node.position('x') + (Math.random()-0.5)*tremorStrength, y: node.position('y') + (Math.random()-0.5)*tremorStrength });
        });
      }, 50); 
    }
    function stopObsidianTremor() { if (tremorInterval) { clearInterval(tremorInterval); tremorInterval = null; } }
    function runLayout(layoutName) {
      stopObsidianTremor(); if (currentLayout) { currentLayout.stop(); currentLayout = null; }
      let opts = layoutName === 'cose' ? { name: 'cose', animate: true, animationDuration: 500, fit: true, padding: 10, nodeRepulsion: 20000, idealEdgeLength: 150, gravity: 0.05 } : { name: 'dagre', rankDir: 'TB', padding: 10, animate: true };
      if(layoutName==='dagre') cy.nodes().unlock();
      const layout = cy.layout(opts); layout.run(); setTimeout(startObsidianTremor, 500); 
    }

    function saveNotes() {
      if (!selected) { alert('ì„ íƒëœ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
      const element = cy.getElementById(selected.id);
      if (element.length === 0) { alert('ì´ë¯¸ ì‚­ì œëœ ìš”ì†Œì…ë‹ˆë‹¤.'); resetRightPanel(); return; }
      
      const newLabel = labelInput.value.trim();
      if (!newLabel) { alert('ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }
      element.data('label', newLabel); element.data('notes', notesTextarea.value);
      if (selected.type === 'node') element.data('color', colorInput.value);
      if (selected.type === 'edge') {
        if (newLabel.toUpperCase() === "TIMELINE" || newLabel.toUpperCase() === "íƒ€ì„ë¼ì¸") element.addClass('timeline'); else element.removeClass('timeline');
      }
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function saveToLocalStorage() { localStorage.setItem("graphData", JSON.stringify(cy.json().elements)); alert('ì €ì¥ ì™„ë£Œ!'); }
    function loadFromLocalStorage() {
      const data = localStorage.getItem("graphData");
      if (data) { cy.elements().remove(); cy.add(JSON.parse(data)); runLayout('cose'); alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!'); } else alert('ë°ì´í„° ì—†ìŒ');
    }
    function saveToURL() { window.location.hash = LZString.compressToEncodedURIComponent(JSON.stringify(cy.json().elements)); alert('URL ì €ì¥ ì™„ë£Œ!'); }
    function downloadJSON() {
      const a = document.createElement('a'); a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(cy.json().elements, null, 2));
      a.download = "graph_" + new Date().toISOString().slice(0, 10) + ".json"; document.body.appendChild(a); a.click(); a.remove();
    }
    function extractElementsFromJSON(data) {
        let elements = [];
        if (data.graphData) {
            const gd = data.graphData;
            if (gd.nodes || gd.edges) elements = [...(gd.nodes||[]), ...(gd.edges||[])];
            else if (gd.elements) elements = gd.elements;
        }
        if (elements.length === 0) {
            if (Array.isArray(data)) elements = data;
            else if (data.nodes || data.edges) elements = [...(data.nodes||[]), ...(data.edges||[])];
            else if (data.elements) elements = Array.isArray(data.elements) ? data.elements : [...(data.elements.nodes||[]), ...(data.elements.edges||[])];
        }
        return elements;
    }
    function uploadJSON(event) {
      const file = event.target.files[0]; if (!file) return;
      const reader = new FileReader(); reader.onload = function (e) { try { const els = extractElementsFromJSON(JSON.parse(e.target.result)); if(els.length){ cy.elements().remove(); cy.add(els); runLayout('cose'); alert('ì„±ê³µ!'); } else alert('ë°ì´í„° ì—†ìŒ'); } catch (err) { alert('ì˜¤ë¥˜: ' + err.message); } }; reader.readAsText(file);
    }
    function appendJSON(event) {
        const file = event.target.files[0]; if (!file) return;
        const reader = new FileReader(); reader.onload = function (e) {
            try {
                const els = extractElementsFromJSON(JSON.parse(e.target.result)); if (!els.length) { alert('ë°ì´í„° ì—†ìŒ'); return; }
                const suffix = "_COPY_" + Date.now(), idMap = {}, newEls = [], offset = 500;
                els.forEach(el => { if (el.data && el.data.id && !el.data.source) { const old = el.data.id, nid = old + suffix; if (cy.getElementById(nid).length) return; const n = JSON.parse(JSON.stringify(el)); n.data.id = nid; n.position = n.position ? {x:n.position.x+offset,y:n.position.y+offset} : {x:cy.width()/2+offset,y:cy.height()/2+offset}; idMap[old] = nid; newEls.push(n); } });
                els.forEach(el => { if (el.data && el.data.source) { if (idMap[el.data.source] && idMap[el.data.target]) { const n = JSON.parse(JSON.stringify(el)); n.data.id = (n.data.id||"EDGE")+suffix; n.data.source = idMap[el.data.source]; n.data.target = idMap[el.data.target]; newEls.push(n); } } });
                if(newEls.length){ cy.add(newEls); runLayout('cose'); alert('ì¶”ê°€ ì™„ë£Œ!'); }
            } catch (err) { alert('ì˜¤ë¥˜: ' + err.message); }
        }; reader.readAsText(file);
    }

    function loadVoices() {
      const vs = speechSynthesis.getVoices(), sel = document.getElementById('voiceSelect'); sel.innerHTML = '';
      const ko = vs.filter(v => v.lang.startsWith('ko'));
      if (ko.length) ko.forEach(v => sel.add(new Option(v.name, v.name))); else sel.add(new Option("ê¸°ë³¸ í•œêµ­ì–´", "default"));
    }
    if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices; loadVoices();
    function updateSpeedValue() { document.getElementById('speedValue').textContent = document.getElementById('speedControl').value + 'x'; }
    function readNotes() {
      const text = notesTextarea.value.trim(); if (!text) return; stopReading();
      currentUtterance = new SpeechSynthesisUtterance(text.replace(/[#*_~`\[\]{}()\-+=|\\<>]/g, ' '));
      const v = speechSynthesis.getVoices().find(v => v.name === document.getElementById('voiceSelect').value);
      if (v) currentUtterance.voice = v; currentUtterance.rate = parseFloat(document.getElementById('speedControl').value);
      speechSynthesis.speak(currentUtterance);
    }
    function stopReading() { if (speechSynthesis.speaking) speechSynthesis.cancel(); }

    // ====================================================================
    // âœ¨ Gemini í”„ë¡¬í”„íŠ¸ ë³µì‚¬ ë° ì±„íŒ… ì—´ê¸° í•¨ìˆ˜ (NEW)
    // ====================================================================
    function copyPromptAndOpenGemini() {
        const promptTextarea = document.getElementById('geminiPromptTemplate');
        const promptText = promptTextarea.value.trim();

        // 1. í…ìŠ¤íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬
        const tempTextarea = document.createElement('textarea');
        tempTextarea.value = promptText;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                alert("âœ… Gemini ìš”ì²­ í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ ìƒˆ ì°½ì—ì„œ 'ë¶„ì„í•  í…ìŠ¤íŠ¸' ë¶€ë¶„ë§Œ ìˆ˜ì • í›„ Geminiì—ê²Œ ìš”ì²­í•˜ì„¸ìš”.");
            } else {
                alert("âŒ í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í”„ë¡¬í”„íŠ¸ ë‚´ìš©ì„ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
            }
        } catch (err) {
            alert("âŒ í´ë¦½ë³´ë“œ ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err);
        } finally {
            document.body.removeChild(tempTextarea);
        }
        
        // 2. Gemini ì±„íŒ… ì°½ì„ ìƒˆ íƒ­ìœ¼ë¡œ ì—´ê¸°
        const geminiUrl = "https://gemini.google.com/app";
        window.open(geminiUrl, "_blank"); 
    }

    // ====================================================================
    // ğŸ¤– JSON í…ìŠ¤íŠ¸ ë³€í™˜ ë° ì¶”ê°€ ê´€ë ¨ í•¨ìˆ˜ (NEW)
    // ====================================================================

    // í…ìŠ¤íŠ¸ ì˜ì—­ì—ì„œ JSON ë°ì´í„°ë¥¼ ì½ì–´ ê·¸ë˜í”„ì— ì¶”ê°€í•˜ê±°ë‚˜ ë®ì–´ì“°ëŠ” í•¨ìˆ˜
    function loadJSONFromTextarea(isAppend) {
        const jsonText = document.getElementById('jsonInputTextarea').value.trim();
        if (!jsonText) {
            alert('JSON í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            const data = JSON.parse(jsonText);
            // ê¸°ì¡´ì— ì •ì˜ëœ extractElementsFromJSON í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
            const els = extractElementsFromJSON(data);

            if (!els.length) {
                alert('ìœ íš¨í•œ ë…¸ë“œ/ì—£ì§€ ë°ì´í„°ê°€ JSONì—ì„œ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            if (isAppend) {
                // ì¶”ê°€ ë¡œì§ (ê¸°ì¡´ appendJSON ë¡œì§ê³¼ ìœ ì‚¬í•˜ê²Œ ID ì¤‘ë³µ ë°©ì§€ ë° ìœ„ì¹˜ ì¡°ì •)
                const suffix = "_COPY_" + Date.now(), idMap = {}, newEls = [], offset = 500;
                
                // ë…¸ë“œì˜ ID ë³€ê²½ ë° ìœ„ì¹˜ ì¡°ì •
                els.forEach(el => {
                    if (el.data && el.data.id && !el.data.source) { // Node
                        const old = el.data.id, nid = old + suffix;
                        if (cy.getElementById(nid).length) return; // Skip if ID collision still occurs (unlikely)
                        const n = JSON.parse(JSON.stringify(el));
                        n.data.id = nid;
                        // ìœ„ì¹˜ ì¡°ì •
                        n.position = n.position ? { x: n.position.x + offset, y: n.position.y + offset } : { x: cy.width() / 2 + offset, y: cy.height() / 2 + offset };
                        idMap[old] = nid;
                        newEls.push(n);
                    }
                });
                
                // ì—£ì§€ì˜ ID ë³€ê²½ ë° ì—°ê²° ë…¸ë“œ ID ì—…ë°ì´íŠ¸
                els.forEach(el => {
                    if (el.data && el.data.source) { // Edge
                        // ë§µí•‘ëœ ìƒˆ IDê°€ ì¡´ì¬í•˜ëŠ” ì—£ì§€ë§Œ ì¶”ê°€
                        if (idMap[el.data.source] && idMap[el.data.target]) {
                            const n = JSON.parse(JSON.stringify(el));
                            n.data.id = (n.data.id || "EDGE_TEXT") + suffix; // ì—£ì§€ IDë„ ê³ ìœ í•˜ê²Œ ë³€ê²½
                            n.data.source = idMap[el.data.source];
                            n.data.target = idMap[el.data.target];
                            newEls.push(n);
                        }
                    }
                });

                if (newEls.length) {
                    cy.add(newEls);
                    runLayout('cose');
                    alert(`JSON í…ìŠ¤íŠ¸ì—ì„œ ${newEls.length}ê°œì˜ ìš”ì†Œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`);
                } else {
                    alert('ì¶”ê°€í•  ìƒˆë¡œìš´ ë…¸ë“œ/ì—£ì§€ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

            } else {
                // ë®ì–´ì“°ê¸° ë¡œì§
                cy.elements().remove();
                cy.add(els);
                runLayout('cose');
                alert('JSON í…ìŠ¤íŠ¸ë¡œ ê·¸ë˜í”„ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë®ì–´ì¼ìŠµë‹ˆë‹¤!');
            }

        } catch (err) {
            alert('JSON íŒŒì‹± ì˜¤ë¥˜! ìœ íš¨í•œ JSON í˜•ì‹ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\nì˜¤ë¥˜: ' + err.message);
        }
    }
  </script>
</body>
</html>